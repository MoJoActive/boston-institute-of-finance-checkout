{"version":3,"file":"shipping-2892dabe.js","mappings":"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","sources":["webpack://checkout/./packages/core/src/app/common/form/connectFormik.tsx","webpack://checkout/./packages/core/src/app/shipping/errors/UnassignItemError.ts","webpack://checkout/./packages/core/src/app/shipping/getShippingMethodId.ts","webpack://checkout/./packages/core/src/app/address/AddressFormModal.tsx","webpack://checkout/./packages/core/src/app/shipping/errors/AssignItemInvalidAddressError.ts","webpack://checkout/./packages/core/src/app/shipping/errors/AssignItemFailedError.ts","webpack://checkout/./packages/core/src/app/shipping/findConsignment.ts","webpack://checkout/./packages/core/src/app/shipping/getShippableLineItems.ts","webpack://checkout/./packages/core/src/app/shipping/ItemAddressSelect.tsx","webpack://checkout/./packages/core/src/app/shipping/getRecommendedShippingOption.ts","webpack://checkout/./packages/core/src/app/shipping/shippingOption/ShippingOptionsList.tsx","webpack://checkout/./packages/core/src/app/shipping/shippingOption/ShippingOptionsForm.tsx","webpack://checkout/./packages/core/src/app/shipping/shippingOption/ShippingOptions.tsx","webpack://checkout/./packages/core/src/app/shipping/ShippingFormFooter.tsx","webpack://checkout/./packages/core/src/app/shipping/MultiShippingForm.tsx","webpack://checkout/./packages/core/src/app/shipping/updateShippableItems.ts","webpack://checkout/./packages/core/src/app/shipping/BillingSameAsShippingField.tsx","webpack://checkout/./packages/core/src/app/shipping/ShippingAddressForm.tsx","webpack://checkout/./packages/core/src/app/shipping/StaticAddressEditable.tsx","webpack://checkout/./packages/core/src/app/shipping/ShippingAddress.tsx","webpack://checkout/./packages/core/src/app/shipping/ShippingAddressFields.ts","webpack://checkout/./packages/core/src/app/shipping/SingleShippingForm.tsx","webpack://checkout/./packages/core/src/app/shipping/ShippingForm.tsx","webpack://checkout/./packages/core/src/app/shipping/ShippingHeader.tsx","webpack://checkout/./packages/core/src/app/shipping/stripeUPE/StripeShippingAddressDisplay.tsx","webpack://checkout/./packages/core/src/app/shipping/stripeUPE/StripeStateMapper.ts","webpack://checkout/./packages/core/src/app/shipping/stripeUPE/StripeShippingAddress.tsx","webpack://checkout/./packages/core/src/app/shipping/stripeUPE/StripeShippingForm.tsx","webpack://checkout/./packages/core/src/app/shipping/stripeUPE/StripeShipping.tsx","webpack://checkout/./packages/core/src/app/shipping/Shipping.tsx","webpack://checkout/./packages/core/src/app/ui/accordion/AccordionContext.tsx","webpack://checkout/./packages/core/src/app/ui/accordion/Accordion.tsx","webpack://checkout/./packages/core/src/app/ui/form/Checklist.tsx","webpack://checkout/./packages/core/src/app/ui/accordion/AccordionItem.tsx","webpack://checkout/./packages/core/src/app/ui/form/ChecklistItemInput.tsx","webpack://checkout/./packages/core/src/app/ui/form/ChecklistItem.tsx"],"sourcesContent":["import { connect } from 'formik';\r\nimport React, { ComponentType, FunctionComponent, memo } from 'react';\r\nimport shallowEqual from 'shallowequal';\r\n\r\nimport ConnectFormikProps from './ConnectFormikProps';\r\n\r\nexport default function connectFormik<TProps extends ConnectFormikProps<TValues>, TValues = any>(\r\n    OriginalComponent: ComponentType<TProps>,\r\n): ComponentType<Omit<TProps, keyof ConnectFormikProps<TValues>>> {\r\n    const InnerComponent: FunctionComponent<TProps> = memo(\r\n        (props) => <OriginalComponent {...props} />,\r\n        ({ formik: prevFormik, ...prevProps }, { formik: nextFormik, ...nextProps }) =>\r\n            shallowEqual(prevFormik, nextFormik) && shallowEqual(prevProps, nextProps),\r\n    );\r\n\r\n    const DecoratedComponent = connect<TProps, TValues>(InnerComponent) as ComponentType<\r\n        Omit<TProps, keyof ConnectFormikProps<TValues>>\r\n    >;\r\n\r\n    DecoratedComponent.displayName = `ConnectFormik(${\r\n        OriginalComponent.displayName || OriginalComponent.name\r\n    })`;\r\n\r\n    return DecoratedComponent;\r\n}\r\n","import { getLanguageService } from '@bigcommerce/checkout/locale';\r\n\r\nimport { CustomError, setPrototypeOf } from '../../common/error';\r\n\r\nexport default class UnassignItemError extends CustomError {\r\n    constructor(data: Error) {\r\n        super({\r\n            name: 'UNASSIGN_ITEM_FAILED',\r\n            message: getLanguageService().translate('shipping.unassign_item_error'),\r\n            data,\r\n        });\r\n\r\n        setPrototypeOf(this, UnassignItemError.prototype);\r\n    }\r\n}\r\n","import { Checkout } from '@bigcommerce/checkout-sdk';\r\n\r\nimport { getPreselectedPayment } from '../payment';\r\n\r\nexport default function getShippingMethodId(checkout: Checkout): string | undefined {\r\n    const SHIPPING_METHOD_IDS = ['amazonpay'];\r\n    const preselectedPayment = getPreselectedPayment(checkout);\r\n\r\n    return preselectedPayment && SHIPPING_METHOD_IDS.indexOf(preselectedPayment.providerId) > -1\r\n        ? preselectedPayment.providerId\r\n        : undefined;\r\n}\r\n","import { Country, FormField } from '@bigcommerce/checkout-sdk';\r\nimport { FormikProps, withFormik } from 'formik';\r\nimport React, { FunctionComponent } from 'react';\r\nimport { lazy } from 'yup';\r\n\r\nimport { TranslatedString, withLanguage, WithLanguageProps } from '@bigcommerce/checkout/locale';\r\n\r\nimport { preventDefault } from '../common/dom';\r\nimport { Button, ButtonVariant } from '../ui/button';\r\nimport { Form } from '../ui/form';\r\nimport { LoadingOverlay } from '../ui/loading';\r\nimport { Modal, ModalHeader } from '../ui/modal';\r\n\r\nimport AddressForm from './AddressForm';\r\nimport getAddressFormFieldsValidationSchema from './getAddressFormFieldsValidationSchema';\r\nimport { AddressFormValues } from './mapAddressToFormValues';\r\n\r\nexport interface AddressFormModalProps extends AddressFormProps {\r\n    isOpen: boolean;\r\n    onAfterOpen?(): void;\r\n}\r\n\r\nexport interface AddressFormProps {\r\n    countries?: Country[];\r\n    countriesWithAutocomplete: string[];\r\n    googleMapsApiKey?: string;\r\n    isLoading: boolean;\r\n    shouldShowSaveAddress?: boolean;\r\n    defaultCountryCode?: string;\r\n    isFloatingLabelEnabled?: boolean;\r\n    getFields(countryCode?: string): FormField[];\r\n    onSaveAddress(address: AddressFormValues): void;\r\n    onRequestClose?(): void;\r\n}\r\n\r\nconst SaveAddress: FunctionComponent<\r\n    AddressFormProps & WithLanguageProps & FormikProps<AddressFormValues>\r\n> = ({\r\n    googleMapsApiKey,\r\n    getFields,\r\n    countriesWithAutocomplete,\r\n    countries,\r\n    values,\r\n    setFieldValue,\r\n    isLoading,\r\n    onRequestClose,\r\n    isFloatingLabelEnabled,\r\n}) => (\r\n    <Form autoComplete=\"on\">\r\n        <LoadingOverlay isLoading={isLoading}>\r\n            <AddressForm\r\n                countries={countries}\r\n                countriesWithAutocomplete={countriesWithAutocomplete}\r\n                countryCode={values.countryCode}\r\n                formFields={getFields(values.countryCode)}\r\n                googleMapsApiKey={googleMapsApiKey}\r\n                isFloatingLabelEnabled={isFloatingLabelEnabled}\r\n                setFieldValue={setFieldValue}\r\n                shouldShowSaveAddress={false}\r\n            />\r\n            <div className=\"form-actions\">\r\n                <a\r\n                    className=\"button optimizedCheckout-buttonSecondary\"\r\n                    href=\"#\"\r\n                    onClick={preventDefault(onRequestClose)}\r\n                >\r\n                    <TranslatedString id=\"common.cancel_action\" />\r\n                </a>\r\n\r\n                <Button\r\n                    disabled={isLoading}\r\n                    id=\"checkout-save-address\"\r\n                    type=\"submit\"\r\n                    variant={ButtonVariant.Primary}\r\n                >\r\n                    <TranslatedString id=\"address.save_address_action\" />\r\n                </Button>\r\n            </div>\r\n        </LoadingOverlay>\r\n    </Form>\r\n);\r\n\r\nconst SaveAddressForm = withLanguage(\r\n    withFormik<AddressFormProps & WithLanguageProps, AddressFormValues>({\r\n        handleSubmit: (values, { props: { onSaveAddress } }) => {\r\n            onSaveAddress(values);\r\n        },\r\n        mapPropsToValues: ({ defaultCountryCode = '' }) => ({\r\n            firstName: '',\r\n            lastName: '',\r\n            address1: '',\r\n            address2: '',\r\n            customFields: {},\r\n            country: '',\r\n            countryCode: defaultCountryCode,\r\n            stateOrProvince: '',\r\n            stateOrProvinceCode: '',\r\n            postalCode: '',\r\n            phone: '',\r\n            city: '',\r\n            company: '',\r\n            shouldSaveAddress: false,\r\n        }),\r\n        validationSchema: ({ language, getFields }: AddressFormProps & WithLanguageProps) =>\r\n            lazy<Partial<AddressFormValues>>((values) =>\r\n                getAddressFormFieldsValidationSchema({\r\n                    language,\r\n                    formFields: getFields(values && values.countryCode),\r\n                }),\r\n            ),\r\n    })(SaveAddress),\r\n);\r\n\r\nconst AddressFormModal: FunctionComponent<AddressFormModalProps> = ({\r\n    isOpen,\r\n    onAfterOpen,\r\n    onRequestClose,\r\n    ...addressFormProps\r\n}) => (\r\n    <Modal\r\n        additionalModalClassName=\"modal--medium\"\r\n        header={\r\n            <ModalHeader>\r\n                <TranslatedString id=\"address.add_address_heading\" />\r\n            </ModalHeader>\r\n        }\r\n        isOpen={isOpen}\r\n        onAfterOpen={onAfterOpen}\r\n        onRequestClose={onRequestClose}\r\n        shouldShowCloseButton={true}\r\n    >\r\n        <SaveAddressForm {...addressFormProps} onRequestClose={onRequestClose} />\r\n    </Modal>\r\n);\r\n\r\nexport default AddressFormModal;\r\n","import { getLanguageService } from '@bigcommerce/checkout/locale';\r\n\r\nimport { CustomError, setPrototypeOf } from '../../common/error';\r\n\r\nexport default class AssignItemInvalidAddressError extends CustomError {\r\n    constructor(data?: Error) {\r\n        super({\r\n            name: 'ASSIGN_ITEM_INVALID_ADDRESS',\r\n            message: getLanguageService().translate('shipping.assign_item_invalid_address_error'),\r\n            title: getLanguageService().translate(\r\n                'shipping.assign_item_invalid_address_error_heading',\r\n            ),\r\n            data,\r\n        });\r\n\r\n        setPrototypeOf(this, AssignItemInvalidAddressError.prototype);\r\n    }\r\n}\r\n","import { getLanguageService } from '@bigcommerce/checkout/locale';\r\n\r\nimport { CustomError, setPrototypeOf } from '../../common/error';\r\n\r\nexport default class AssignItemFailedError extends CustomError {\r\n    constructor(data: Error) {\r\n        super({\r\n            name: 'ASSIGN_ITEM_FAILED',\r\n            message: getLanguageService().translate('shipping.assign_item_error'),\r\n            data,\r\n        });\r\n\r\n        setPrototypeOf(this, AssignItemFailedError.prototype);\r\n    }\r\n}\r\n","import { Consignment } from '@bigcommerce/checkout-sdk';\r\nimport { find, includes } from 'lodash';\r\n\r\nexport default function findConsignment(\r\n    consignments: Consignment[],\r\n    itemId: string,\r\n): Consignment | undefined {\r\n    return find(consignments, (consignment) => includes(consignment.lineItemIds, itemId));\r\n}\r\n","import { Cart, Consignment, PhysicalItem } from '@bigcommerce/checkout-sdk';\r\nimport { isNil, reduce } from 'lodash';\r\n\r\nimport findConsignment from './findConsignment';\r\nimport ShippableItem from './ShippableItem';\r\n\r\nexport default function getShippableLineItems(\r\n    cart: Cart,\r\n    consignments: Consignment[],\r\n): ShippableItem[] {\r\n    return reduce(\r\n        (cart && cart.lineItems.physicalItems) || [],\r\n        (result, item, i) =>\r\n            !item.addedByPromotion && isNil(item.parentId)\r\n                ? result.concat(...splitItem(item, consignments, i))\r\n                : result,\r\n        [] as ShippableItem[],\r\n    );\r\n}\r\n\r\nfunction splitItem(\r\n    item: PhysicalItem,\r\n    consignments: Consignment[],\r\n    lineItemIndex: number,\r\n): ShippableItem[] {\r\n    let splitItems: ShippableItem[] = [];\r\n    const consignment = findConsignment(consignments, item.id as string);\r\n\r\n    for (let i = 0; i < item.quantity; i++) {\r\n        splitItems = splitItems.concat({\r\n            ...item,\r\n            key: `${item.variantId}-${item.productId}-${lineItemIndex}-${i}`,\r\n            consignment,\r\n            quantity: 1,\r\n        });\r\n    }\r\n\r\n    return splitItems;\r\n}\r\n","import { Address, CustomerAddress } from '@bigcommerce/checkout-sdk';\r\nimport React, { FunctionComponent, memo, useCallback } from 'react';\r\n\r\nimport { AddressSelect } from '../address';\r\n\r\nimport ShippableItem from './ShippableItem';\r\n\r\nexport interface ItemAddressSelectProps {\r\n    item: ShippableItem;\r\n    addresses: CustomerAddress[];\r\n    onSelectAddress(address: Address, itemId: string, itemKey: string): void;\r\n    onUseNewAddress(address: Address | undefined, itemId: string, itemKey: string): void;\r\n}\r\n\r\nconst ItemAddressSelect: FunctionComponent<ItemAddressSelectProps> = ({\r\n    item: { id, key, imageUrl, quantity, name, options, consignment },\r\n    addresses,\r\n    onSelectAddress,\r\n    onUseNewAddress,\r\n}) => {\r\n    const handleUseNewAddress = useCallback(\r\n        (address: Address) => {\r\n            onUseNewAddress(address, id as string, key);\r\n        },\r\n        [id, onUseNewAddress, key],\r\n    );\r\n\r\n    const handleSelectAddress = useCallback(\r\n        (address: Address) => {\r\n            onSelectAddress(address, id as string, key);\r\n        },\r\n        [id, key, onSelectAddress],\r\n    );\r\n\r\n    return (\r\n        <div className=\"consignment\">\r\n            <figure className=\"consignment-product-figure\">\r\n                {imageUrl && <img alt={name} src={imageUrl} />}\r\n            </figure>\r\n\r\n            <div className=\"consignment-product-body\">\r\n                <h4 className=\"optimizedCheckout-contentPrimary\">{`${quantity} x ${name}`}</h4>\r\n\r\n                {(options || []).map(({ name: optionName, value, nameId }) => (\r\n                    <ul\r\n                        className=\"product-options optimizedCheckout-contentSecondary\"\r\n                        data-test=\"consigment-item-product-options\"\r\n                        key={nameId}\r\n                    >\r\n                        <li className=\"product-option\">{`${optionName} ${value}`}</li>\r\n                    </ul>\r\n                ))}\r\n\r\n                <AddressSelect\r\n                    addresses={addresses}\r\n                    onSelectAddress={handleSelectAddress}\r\n                    onUseNewAddress={handleUseNewAddress}\r\n                    selectedAddress={consignment && consignment.shippingAddress}\r\n                />\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default memo(ItemAddressSelect);\r\n","import { ShippingOption } from '@bigcommerce/checkout-sdk';\r\n\r\nexport default function getRecommendedShippingOption(\r\n    availableShippingOptions: ShippingOption[],\r\n): ShippingOption | undefined {\r\n    if (!availableShippingOptions) {\r\n        return;\r\n    }\r\n\r\n    return availableShippingOptions.find(\r\n        ({ isRecommended }: { isRecommended: any }) => isRecommended,\r\n    );\r\n}\r\n","import { ShippingOption } from '@bigcommerce/checkout-sdk';\r\nimport React, { FunctionComponent, memo, useCallback } from 'react';\r\n\r\nimport { EMPTY_ARRAY } from '../../common/utility';\r\nimport { Checklist, ChecklistItem } from '../../ui/form';\r\nimport { LoadingOverlay } from '../../ui/loading';\r\n\r\nimport StaticShippingOption from './StaticShippingOption';\r\n\r\ninterface ShippingOptionListItemProps {\r\n    consignmentId: string;\r\n    shippingOption: ShippingOption;\r\n}\r\n\r\nconst ShippingOptionListItem: FunctionComponent<ShippingOptionListItemProps> = ({\r\n    consignmentId,\r\n    shippingOption,\r\n}) => {\r\n    const renderLabel = useCallback(\r\n        () => (\r\n            <div className=\"shippingOptionLabel\">\r\n                <StaticShippingOption displayAdditionalInformation={true} method={shippingOption} />\r\n            </div>\r\n        ),\r\n        [shippingOption],\r\n    );\r\n\r\n    return (\r\n        <ChecklistItem\r\n            htmlId={`shippingOptionRadio-${consignmentId}-${shippingOption.id}`}\r\n            label={renderLabel}\r\n            value={shippingOption.id}\r\n        />\r\n    );\r\n};\r\n\r\nexport interface ShippingOptionListProps {\r\n    consignmentId: string;\r\n    inputName: string;\r\n    isLoading: boolean;\r\n    selectedShippingOptionId?: string;\r\n    shippingOptions?: ShippingOption[];\r\n    onSelectedOption(consignmentId: string, shippingOptionId: string): void;\r\n}\r\n\r\nconst ShippingOptionsList: FunctionComponent<ShippingOptionListProps> = ({\r\n    consignmentId,\r\n    inputName,\r\n    isLoading,\r\n    shippingOptions = EMPTY_ARRAY,\r\n    selectedShippingOptionId,\r\n    onSelectedOption,\r\n}) => {\r\n    const handleSelect = useCallback(\r\n        (value: string) => {\r\n            onSelectedOption(consignmentId, value);\r\n        },\r\n        [consignmentId, onSelectedOption],\r\n    );\r\n\r\n    if (!shippingOptions.length) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <LoadingOverlay isLoading={isLoading}>\r\n            <Checklist\r\n                aria-live=\"polite\"\r\n                defaultSelectedItemId={selectedShippingOptionId}\r\n                name={inputName}\r\n                onSelect={handleSelect}\r\n            >\r\n                {shippingOptions.map((shippingOption) => (\r\n                    <ShippingOptionListItem\r\n                        consignmentId={consignmentId}\r\n                        key={shippingOption.id}\r\n                        shippingOption={shippingOption}\r\n                    />\r\n                ))}\r\n            </Checklist>\r\n        </LoadingOverlay>\r\n    );\r\n};\r\n\r\nexport default memo(ShippingOptionsList);\r\n","import { CheckoutSelectors, Consignment } from '@bigcommerce/checkout-sdk';\r\nimport { FormikProps, withFormik } from 'formik';\r\nimport { noop } from 'lodash';\r\nimport React, { PureComponent, ReactNode } from 'react';\r\n\r\nimport { AnalyticsContextProps } from '@bigcommerce/checkout/analytics';\r\nimport { TranslatedString } from '@bigcommerce/checkout/locale';\r\nimport { ChecklistSkeleton } from '@bigcommerce/checkout/ui';\r\n\r\nimport { StaticAddress } from '../../address';\r\nimport { withAnalytics } from '../../analytics';\r\nimport getRecommendedShippingOption from '../getRecommendedShippingOption';\r\nimport StaticConsignmentItemList from '../StaticConsignmentItemList';\r\n\r\nimport { ShippingOptionsProps, WithCheckoutShippingOptionsProps } from './ShippingOptions';\r\nimport './ShippingOptionsForm.scss';\r\nimport ShippingOptionsList from './ShippingOptionsList';\r\n\r\nexport type ShippingOptionsFormProps = ShippingOptionsProps & WithCheckoutShippingOptionsProps & AnalyticsContextProps;\r\n\r\nclass ShippingOptionsForm extends PureComponent<\r\n    ShippingOptionsFormProps & FormikProps<ShippingOptionsFormValues>\r\n> {\r\n    private unsubscribe?: () => void;\r\n\r\n    componentDidMount(): void {\r\n        const { subscribeToConsignments } = this.props;\r\n\r\n        this.unsubscribe = subscribeToConsignments(this.selectDefaultShippingOptions);\r\n    }\r\n\r\n    componentDidUpdate(): void {\r\n        const {\r\n            analyticsTracker,\r\n            consignments,\r\n            shouldShowShippingOptions\r\n        } = this.props;\r\n\r\n        if (consignments?.length && shouldShowShippingOptions) {\r\n            analyticsTracker.showShippingMethods();\r\n        }\r\n    }\r\n\r\n    componentWillUnmount(): void {\r\n        if (this.unsubscribe) {\r\n            this.unsubscribe();\r\n            this.unsubscribe = undefined;\r\n        }\r\n    }\r\n\r\n    render(): ReactNode {\r\n        const {\r\n            consignments,\r\n            isMultiShippingMode,\r\n            selectShippingOption,\r\n            isLoading,\r\n            shouldShowShippingOptions,\r\n            invalidShippingMessage,\r\n            methodId\r\n        } = this.props;\r\n\r\n        if (!consignments?.length || !shouldShowShippingOptions) {\r\n            return (\r\n                <ChecklistSkeleton\r\n                    additionalClassName=\"shippingOptions-skeleton\"\r\n                    isLoading={isLoading()}\r\n                    rows={2}\r\n                >\r\n                    {this.renderNoShippingOptions(\r\n                        <TranslatedString\r\n                            id={\r\n                                methodId || isMultiShippingMode\r\n                                    ? 'shipping.select_shipping_address_text'\r\n                                    : 'shipping.enter_shipping_address_text'\r\n                            }\r\n                        />,\r\n                    )}\r\n                </ChecklistSkeleton>\r\n            );\r\n        }\r\n\r\n        return (\r\n            <>\r\n                {consignments.map((consignment) => (\r\n                    <div className=\"shippingOptions-container form-fieldset\" key={consignment.id}>\r\n                        {isMultiShippingMode && this.renderConsignment(consignment)}\r\n\r\n                        <ShippingOptionsList\r\n                            consignmentId={consignment.id}\r\n                            inputName={getRadioInputName(consignment.id)}\r\n                            isLoading={isLoading(consignment.id)}\r\n                            onSelectedOption={selectShippingOption}\r\n                            selectedShippingOptionId={\r\n                                consignment.selectedShippingOption &&\r\n                                consignment.selectedShippingOption.id\r\n                            }\r\n                            shippingOptions={consignment.availableShippingOptions}\r\n                        />\r\n\r\n                        {(!consignment.availableShippingOptions ||\r\n                            !consignment.availableShippingOptions.length) && (\r\n                            <ChecklistSkeleton\r\n                                additionalClassName=\"shippingOptions-skeleton\"\r\n                                isLoading={isLoading(consignment.id)}\r\n                                rows={2}\r\n                            >\r\n                                {this.renderNoShippingOptions(invalidShippingMessage)}\r\n                            </ChecklistSkeleton>\r\n                        )}\r\n                    </div>\r\n                ))}\r\n            </>\r\n        );\r\n    }\r\n\r\n    private selectDefaultShippingOptions: (state: CheckoutSelectors) => void = async ({ data }) => {\r\n        const { selectShippingOption, setFieldValue } = this.props;\r\n\r\n        const consignment = (data.getConsignments() || []).find(\r\n            ({ selectedShippingOption, availableShippingOptions: shippingOptions }) =>\r\n                !selectedShippingOption && shippingOptions,\r\n        );\r\n\r\n        if (!consignment || !consignment.availableShippingOptions) {\r\n            return;\r\n        }\r\n\r\n        const { availableShippingOptions, id } = consignment;\r\n        const recommendedOption = getRecommendedShippingOption(availableShippingOptions);\r\n        const singleShippingOption =\r\n            availableShippingOptions.length === 1 && availableShippingOptions[0];\r\n        const defaultShippingOption = recommendedOption || singleShippingOption;\r\n\r\n        if (!defaultShippingOption) {\r\n            return;\r\n        }\r\n\r\n        await selectShippingOption(id, defaultShippingOption.id);\r\n        setFieldValue(`shippingOptionIds.${id}`, defaultShippingOption.id);\r\n    };\r\n\r\n    private renderNoShippingOptions(message: ReactNode): ReactNode {\r\n        return (\r\n            <div className=\"shippingOptions-panel optimizedCheckout-overlay\">\r\n                <p\r\n                    aria-live=\"polite\"\r\n                    className=\"shippingOptions-panel-message optimizedCheckout-primaryContent\"\r\n                    role=\"alert\"\r\n                >\r\n                    {message}\r\n                </p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private renderConsignment(consignment: Consignment): ReactNode {\r\n        const { cart } = this.props;\r\n\r\n        return (\r\n            <div className=\"staticConsignment\">\r\n                <strong>\r\n                    <TranslatedString id=\"shipping.shipping_address_heading\" />\r\n                </strong>\r\n\r\n                <StaticAddress address={consignment.shippingAddress} />\r\n\r\n                <StaticConsignmentItemList cart={cart} consignment={consignment} />\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nfunction getRadioInputName(consignmentId: string): string {\r\n    return `shippingOptionIds.${consignmentId}`;\r\n}\r\n\r\nexport interface ShippingOptionsFormValues {\r\n    shippingOptionIds: {\r\n        [shippingOptionIds: string]: string;\r\n    };\r\n}\r\n\r\nexport default withAnalytics(withFormik<ShippingOptionsFormProps, ShippingOptionsFormValues>({\r\n    handleSubmit: noop,\r\n    mapPropsToValues({ consignments }) {\r\n        const shippingOptionIds: { [id: string]: string } = {};\r\n\r\n        (consignments || []).forEach((consignment) => {\r\n            shippingOptionIds[consignment.id] = consignment.selectedShippingOption\r\n                ? consignment.selectedShippingOption.id\r\n                : '';\r\n        });\r\n\r\n        return { shippingOptionIds };\r\n    },\r\n})(ShippingOptionsForm));\r\n","import { Cart, CheckoutSelectors, Consignment } from '@bigcommerce/checkout-sdk';\r\nimport { map, sortBy, uniq } from 'lodash';\r\nimport { createSelector } from 'reselect';\r\n\r\nimport { CheckoutContextProps } from '@bigcommerce/checkout/payment-integration-api';\r\n\r\nimport { withCheckout } from '../../checkout';\r\nimport getShippableLineItems from '../getShippableLineItems';\r\nimport getShippingMethodId from '../getShippingMethodId';\r\n\r\nimport ShippingOptionsForm from './ShippingOptionsForm';\r\n\r\nexport interface ShippingOptionsProps {\r\n    isMultiShippingMode: boolean;\r\n    isUpdatingAddress?: boolean;\r\n    shouldShowShippingOptions: boolean;\r\n}\r\n\r\nexport interface WithCheckoutShippingOptionsProps {\r\n    invalidShippingMessage: string;\r\n    methodId?: string;\r\n    consignments?: Consignment[];\r\n    cart: Cart;\r\n    isSelectingShippingOption(consignmentId?: string): boolean;\r\n    subscribeToConsignments(subscriber: (state: CheckoutSelectors) => void): () => void;\r\n    selectShippingOption(consignmentId: string, optionId: string): Promise<CheckoutSelectors>;\r\n    isLoading(consignmentId?: string): boolean;\r\n}\r\n\r\nconst subscribeToConsignmentsSelector = createSelector(\r\n    ({ checkoutService }: CheckoutContextProps) => checkoutService.subscribe,\r\n    (subscribe) => (subscriber: (state: CheckoutSelectors) => void) => {\r\n        return subscribe(subscriber, ({ data }) => data.getConsignments());\r\n    },\r\n);\r\n\r\nconst isLoadingSelector = createSelector(\r\n    (_: CheckoutSelectors, { isUpdatingAddress }: ShippingOptionsProps) => isUpdatingAddress,\r\n    ({ statuses }: CheckoutSelectors) => statuses.isLoadingShippingOptions,\r\n    ({ statuses }: CheckoutSelectors) => statuses.isSelectingShippingOption,\r\n    ({ statuses }: CheckoutSelectors) => statuses.isUpdatingConsignment,\r\n    ({ statuses }: CheckoutSelectors) => statuses.isCreatingConsignments,\r\n    (\r\n        isUpdatingAddress,\r\n        isLoadingShippingOptions,\r\n        isSelectingShippingOption,\r\n        isUpdatingConsignment,\r\n        isCreatingConsignments,\r\n    ) => {\r\n        return (consignmentId?: string) => {\r\n            return (\r\n                isUpdatingAddress ||\r\n                isLoadingShippingOptions() ||\r\n                isSelectingShippingOption(consignmentId) ||\r\n                isUpdatingConsignment(consignmentId) ||\r\n                isCreatingConsignments()\r\n            );\r\n        };\r\n    },\r\n);\r\n\r\nconst sortConsignments = (cart: Cart, unsortedConsignments: Consignment[]): Consignment[] => {\r\n    if (unsortedConsignments.length < 2) {\r\n        return unsortedConsignments;\r\n    }\r\n\r\n    const shippableItems = getShippableLineItems(cart, unsortedConsignments);\r\n    const consignmentsOrder = uniq(map(shippableItems, 'consignment.id'));\r\n\r\n    return sortBy(unsortedConsignments, (consignment) => consignmentsOrder.indexOf(consignment.id));\r\n};\r\n\r\nexport function mapToShippingOptions(\r\n    { checkoutService, checkoutState }: CheckoutContextProps,\r\n    props: ShippingOptionsProps,\r\n): WithCheckoutShippingOptionsProps | null {\r\n    const {\r\n        data: { getCart, getConsignments, getConfig, getCustomer, getCheckout },\r\n        statuses: { isSelectingShippingOption },\r\n    } = checkoutState;\r\n\r\n    const customer = getCustomer();\r\n    const cart = getCart();\r\n    const config = getConfig();\r\n    const checkout = getCheckout();\r\n\r\n    if (!config || !checkout || !customer || !cart) {\r\n        return null;\r\n    }\r\n\r\n    const consignments = sortConsignments(cart, getConsignments() || []);\r\n    const methodId = getShippingMethodId(checkout);\r\n    const { shippingQuoteFailedMessage } = config.checkoutSettings;\r\n\r\n    return {\r\n        cart,\r\n        consignments,\r\n        invalidShippingMessage: shippingQuoteFailedMessage,\r\n        isLoading: isLoadingSelector(checkoutState, props),\r\n        isSelectingShippingOption,\r\n        methodId,\r\n        selectShippingOption: checkoutService.selectConsignmentShippingOption,\r\n        subscribeToConsignments: subscribeToConsignmentsSelector({\r\n            checkoutService,\r\n            checkoutState,\r\n        }),\r\n    };\r\n}\r\n\r\nexport default withCheckout(mapToShippingOptions)(ShippingOptionsForm);\r\n","import React, { PureComponent, ReactNode } from 'react';\r\n\r\nimport { TranslatedString } from '@bigcommerce/checkout/locale';\r\n\r\nimport { OrderComments } from '../orderComments';\r\nimport { Alert, AlertType } from '../ui/alert';\r\nimport { Button, ButtonVariant } from '../ui/button';\r\nimport { Fieldset, Legend } from '../ui/form';\r\n\r\nimport { ShippingOptions } from './shippingOption';\r\n\r\nexport interface ShippingFormFooterProps {\r\n    cartHasChanged: boolean;\r\n    isMultiShippingMode: boolean;\r\n    shouldShowOrderComments: boolean;\r\n    shouldShowShippingOptions?: boolean;\r\n    shouldDisableSubmit: boolean;\r\n    isLoading: boolean;\r\n}\r\n\r\nclass ShippingFormFooter extends PureComponent<ShippingFormFooterProps> {\r\n    render(): ReactNode {\r\n        const {\r\n            cartHasChanged,\r\n            isMultiShippingMode,\r\n            shouldShowOrderComments,\r\n            shouldShowShippingOptions = true,\r\n            shouldDisableSubmit,\r\n            isLoading,\r\n        } = this.props;\r\n\r\n        return (\r\n            <>\r\n                <Fieldset\r\n                    id=\"checkout-shipping-options\"\r\n                    legend={\r\n                        <>\r\n                            <Legend>\r\n                                <TranslatedString id=\"shipping.shipping_method_label\" />\r\n                            </Legend>\r\n\r\n                            {cartHasChanged && (\r\n                                <Alert type={AlertType.Error}>\r\n                                    <strong>\r\n                                        <TranslatedString id=\"shipping.cart_change_error\" />\r\n                                    </strong>\r\n                                </Alert>\r\n                            )}\r\n                        </>\r\n                    }\r\n                >\r\n                    <ShippingOptions\r\n                        isMultiShippingMode={isMultiShippingMode}\r\n                        isUpdatingAddress={isLoading}\r\n                        shouldShowShippingOptions={shouldShowShippingOptions}\r\n                    />\r\n                </Fieldset>\r\n\r\n                {shouldShowOrderComments && <OrderComments />}\r\n\r\n                <div className=\"form-actions\">\r\n                    <Button\r\n                        disabled={shouldDisableSubmit}\r\n                        id=\"checkout-shipping-continue\"\r\n                        isLoading={isLoading}\r\n                        type=\"submit\"\r\n                        variant={ButtonVariant.Primary}\r\n                    >\r\n                        <TranslatedString id=\"common.continue_action\" />\r\n                    </Button>\r\n                </div>\r\n            </>\r\n        );\r\n    }\r\n}\r\n\r\nexport default ShippingFormFooter;\r\n","import {\r\n    Address,\r\n    AddressRequestBody,\r\n    Cart,\r\n    CheckoutSelectors,\r\n    CheckoutStoreSelector,\r\n    Consignment,\r\n    ConsignmentAssignmentRequestBody,\r\n    Country,\r\n    CustomerAddress,\r\n    FormField,\r\n} from '@bigcommerce/checkout-sdk';\r\nimport { FormikProps, withFormik } from 'formik';\r\nimport React, { PureComponent, ReactNode } from 'react';\r\n\r\nimport { TranslatedLink, TranslatedString, withLanguage, WithLanguageProps } from '@bigcommerce/checkout/locale';\r\n\r\nimport {\r\n    AddressFormModal,\r\n    AddressFormValues,\r\n    isValidAddress,\r\n    mapAddressFromFormValues,\r\n} from '../address';\r\nimport { preventDefault } from '../common/dom';\r\nimport { ErrorModal } from '../common/error';\r\nimport { Form } from '../ui/form';\r\n\r\nimport { AssignItemFailedError, AssignItemInvalidAddressError } from './errors';\r\nimport getShippableItemsCount from './getShippableItemsCount';\r\nimport getShippableLineItems from './getShippableLineItems';\r\nimport hasSelectedShippingOptions from './hasSelectedShippingOptions';\r\nimport hasUnassignedLineItems from './hasUnassignedLineItems';\r\nimport ItemAddressSelect from './ItemAddressSelect';\r\nimport ShippableItem from './ShippableItem';\r\nimport ShippingFormFooter from './ShippingFormFooter';\r\nimport updateShippableItems from './updateShippableItems';\r\n\r\nexport interface MultiShippingFormProps {\r\n    addresses: CustomerAddress[];\r\n    cart: Cart;\r\n    cartHasChanged: boolean;\r\n    consignments: Consignment[];\r\n    customerMessage: string;\r\n    isGuest: boolean;\r\n    isLoading: boolean;\r\n    shouldShowOrderComments: boolean;\r\n    defaultCountryCode?: string;\r\n    countries?: Country[];\r\n    countriesWithAutocomplete: string[];\r\n    googleMapsApiKey?: string;\r\n    shouldShowAddAddressInCheckout: boolean;\r\n    isFloatingLabelEnabled?: boolean;\r\n    assignItem(consignment: ConsignmentAssignmentRequestBody): Promise<CheckoutSelectors>;\r\n    onCreateAccount(): void;\r\n    createCustomerAddress(address: AddressRequestBody): void;\r\n    onSignIn(): void;\r\n    getFields(countryCode?: string): FormField[];\r\n    onSubmit(values: MultiShippingFormValues): void;\r\n    onUnhandledError(error: Error): void;\r\n    onUseNewAddress(address: Address, itemId: string): void;\r\n}\r\n\r\ninterface ShippableItemId {\r\n    key: string;\r\n    itemId: string;\r\n}\r\n\r\nexport interface MultiShippingFormState {\r\n    items: ShippableItem[];\r\n    itemAddingAddress?: ShippableItemId;\r\n    createCustomerAddressError?: Error;\r\n}\r\n\r\nclass MultiShippingForm extends PureComponent<\r\n    MultiShippingFormProps & WithLanguageProps & FormikProps<MultiShippingFormValues>,\r\n    MultiShippingFormState\r\n> {\r\n    static getDerivedStateFromProps(\r\n        { cart, consignments }: MultiShippingFormProps,\r\n        state: MultiShippingFormState,\r\n    ) {\r\n        if (!state || !state.items || getShippableItemsCount(cart) !== state.items.length) {\r\n            return { items: getShippableLineItems(cart, consignments) };\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    state: MultiShippingFormState = { items: [] };\r\n\r\n    render(): ReactNode {\r\n        const {\r\n            addresses,\r\n            consignments,\r\n            cart,\r\n            isGuest,\r\n            onSignIn,\r\n            onCreateAccount,\r\n            cartHasChanged,\r\n            shouldShowOrderComments,\r\n            isLoading,\r\n            getFields,\r\n            defaultCountryCode,\r\n            countries,\r\n            countriesWithAutocomplete,\r\n            googleMapsApiKey,\r\n            isFloatingLabelEnabled,\r\n        } = this.props;\r\n\r\n        const { items, itemAddingAddress, createCustomerAddressError } = this.state;\r\n\r\n        if (isGuest) {\r\n            return (\r\n                <div className=\"checkout-step-info\">\r\n                    <TranslatedString id=\"shipping.multishipping_guest_intro\" />{' '}\r\n                    <a\r\n                        data-test=\"shipping-sign-in-link\"\r\n                        href=\"#\"\r\n                        onClick={preventDefault(onSignIn)}\r\n                    >\r\n                        <TranslatedString id=\"shipping.multishipping_guest_sign_in\" />\r\n                    </a>{' '}\r\n                    <TranslatedLink\r\n                        id=\"shipping.multishipping_guest_create\"\r\n                        onClick={onCreateAccount}\r\n                    />\r\n                </div>\r\n            );\r\n        }\r\n\r\n        return (\r\n            <>\r\n                <ErrorModal\r\n                    error={createCustomerAddressError}\r\n                    message={\r\n                        <>\r\n                            <TranslatedString id=\"address.consignment_address_updated_text\" />{' '}\r\n                            <TranslatedString id=\"customer.create_address_error\" />\r\n                        </>\r\n                    }\r\n                    onClose={this.handleCloseErrorModal}\r\n                    shouldShowErrorCode={false}\r\n                />\r\n                <AddressFormModal\r\n                    countries={countries}\r\n                    countriesWithAutocomplete={countriesWithAutocomplete}\r\n                    defaultCountryCode={defaultCountryCode}\r\n                    getFields={getFields}\r\n                    googleMapsApiKey={googleMapsApiKey}\r\n                    isFloatingLabelEnabled={isFloatingLabelEnabled}\r\n                    isLoading={isLoading}\r\n                    isOpen={!!itemAddingAddress}\r\n                    onRequestClose={this.handleCloseAddAddressForm}\r\n                    onSaveAddress={this.handleSaveAddress}\r\n                />\r\n\r\n                <Form>\r\n                    <ul className=\"consignmentList\">\r\n                        {items.map((item) => (\r\n                            <li key={item.key}>\r\n                                <ItemAddressSelect\r\n                                    addresses={addresses}\r\n                                    item={item}\r\n                                    onSelectAddress={this.handleSelectAddress}\r\n                                    onUseNewAddress={this.handleUseNewAddress}\r\n                                />\r\n                            </li>\r\n                        ))}\r\n                    </ul>\r\n\r\n                    <ShippingFormFooter\r\n                        cartHasChanged={cartHasChanged}\r\n                        isLoading={isLoading}\r\n                        isMultiShippingMode={true}\r\n                        shouldDisableSubmit={this.shouldDisableSubmit()}\r\n                        shouldShowOrderComments={shouldShowOrderComments}\r\n                        shouldShowShippingOptions={\r\n                            !hasUnassignedLineItems(consignments, cart.lineItems)\r\n                        }\r\n                    />\r\n                </Form>\r\n            </>\r\n        );\r\n    }\r\n\r\n    private handleCloseErrorModal: () => void = () => {\r\n        this.setState({ createCustomerAddressError: undefined });\r\n    };\r\n\r\n    private handleSaveAddress: (address: AddressFormValues) => void = async (address) => {\r\n        const { createCustomerAddress } = this.props;\r\n        const { itemAddingAddress } = this.state;\r\n\r\n        if (!itemAddingAddress) {\r\n            return;\r\n        }\r\n\r\n        const shippingAddress = mapAddressFromFormValues(address);\r\n\r\n        await this.handleSelectAddress(\r\n            shippingAddress,\r\n            itemAddingAddress.itemId,\r\n            itemAddingAddress.key,\r\n        );\r\n\r\n        try {\r\n            await createCustomerAddress(shippingAddress);\r\n        } catch (error) {\r\n            if (error instanceof Error) {\r\n                this.setState({ createCustomerAddressError: error });\r\n            }\r\n        }\r\n\r\n        this.setState({\r\n            itemAddingAddress: undefined,\r\n        });\r\n    };\r\n\r\n    private handleUseNewAddress: (address: Address, itemId: string, itemKey: string) => void = (\r\n        address,\r\n        itemId,\r\n        itemKey,\r\n    ) => {\r\n        const { onUseNewAddress, shouldShowAddAddressInCheckout } = this.props;\r\n\r\n        if (!shouldShowAddAddressInCheckout) {\r\n            onUseNewAddress(address, itemId);\r\n\r\n            return;\r\n        }\r\n\r\n        this.setState({\r\n            itemAddingAddress: {\r\n                key: itemKey,\r\n                itemId,\r\n            },\r\n        });\r\n    };\r\n\r\n    private handleCloseAddAddressForm: () => void = () => {\r\n        this.setState({\r\n            itemAddingAddress: undefined,\r\n        });\r\n    };\r\n\r\n    private handleSelectAddress: (\r\n        address: Address,\r\n        itemId: string,\r\n        itemKey: string,\r\n    ) => Promise<void> = async (address, itemId, itemKey) => {\r\n        const { assignItem, onUnhandledError, getFields } = this.props;\r\n\r\n        if (!isValidAddress(address, getFields(address.countryCode))) {\r\n            return onUnhandledError(new AssignItemInvalidAddressError());\r\n        }\r\n\r\n        try {\r\n            const { data } = await assignItem({\r\n                address,\r\n                lineItems: [\r\n                    {\r\n                        itemId,\r\n                        quantity: 1,\r\n                    },\r\n                ],\r\n            });\r\n\r\n            this.syncItems(itemKey, address, data);\r\n        } catch (error) {\r\n            if (error instanceof Error) {\r\n                onUnhandledError(new AssignItemFailedError(error));\r\n            }\r\n        }\r\n    };\r\n\r\n    private shouldDisableSubmit: () => boolean = () => {\r\n        const { isLoading, consignments } = this.props;\r\n\r\n        return isLoading || !hasSelectedShippingOptions(consignments);\r\n    };\r\n\r\n    private syncItems: (key: string, address: Address, data: CheckoutStoreSelector) => void = (\r\n        key,\r\n        address,\r\n        data,\r\n    ) => {\r\n        const { items: currentItems } = this.state;\r\n        const items = updateShippableItems(\r\n            currentItems,\r\n            {\r\n                updatedItemIndex: currentItems.findIndex((item) => item.key === key),\r\n                address,\r\n            },\r\n            {\r\n                cart: data.getCart(),\r\n                consignments: data.getConsignments(),\r\n            },\r\n        );\r\n\r\n        if (items) {\r\n            this.setState({ items });\r\n        }\r\n    };\r\n}\r\n\r\nexport interface MultiShippingFormValues {\r\n    orderComment: string;\r\n}\r\n\r\nexport default withLanguage(\r\n    withFormik<MultiShippingFormProps & WithLanguageProps, MultiShippingFormValues>({\r\n        handleSubmit: (values, { props: { onSubmit } }) => {\r\n            onSubmit(values);\r\n        },\r\n        mapPropsToValues: ({ customerMessage }) => ({\r\n            orderComment: customerMessage,\r\n        }),\r\n        enableReinitialize: true,\r\n    })(MultiShippingForm),\r\n);\r\n","import { Address, Cart, Consignment } from '@bigcommerce/checkout-sdk';\r\n\r\nimport { isEqualAddress } from '../address';\r\n\r\nimport findConsignment from './findConsignment';\r\nimport ShippableItem from './ShippableItem';\r\n\r\nexport interface UpdateItemParams {\r\n    updatedItemIndex: number;\r\n    address: Address;\r\n}\r\n\r\nexport default function updateShippableItems(\r\n    items: ShippableItem[],\r\n    { updatedItemIndex, address }: UpdateItemParams,\r\n    { cart, consignments }: { cart?: Cart; consignments?: Consignment[] },\r\n): ShippableItem[] | undefined {\r\n    if (updatedItemIndex < 0 || updatedItemIndex >= items.length || !cart) {\r\n        return;\r\n    }\r\n\r\n    const cartItemIds = cart.lineItems.physicalItems.map(({ id }) => id);\r\n\r\n    const updatedConsignment = (consignments || []).find((consignment) =>\r\n        isEqualAddress(consignment.shippingAddress, address),\r\n    );\r\n\r\n    const newId = findNewItemId(items[updatedItemIndex], cart, updatedConsignment);\r\n\r\n    return items.map((item, i) => {\r\n        if ((newId && !cartItemIds.includes(item.id)) || i === updatedItemIndex) {\r\n            const itemId = newId ?? item.id;\r\n\r\n            return {\r\n                ...item,\r\n                id: itemId,\r\n                consignment: findConsignment(consignments || [], itemId as string),\r\n            };\r\n        }\r\n\r\n        return item;\r\n    });\r\n}\r\n\r\nfunction findNewItemId(\r\n    item: ShippableItem,\r\n    cart?: Cart,\r\n    consignment?: Consignment,\r\n): string | undefined {\r\n    if (!cart || !consignment) {\r\n        return;\r\n    }\r\n\r\n    const { physicalItems } = cart.lineItems;\r\n    const matchingCartItems = physicalItems.filter(\r\n        ({ productId, variantId }) => productId === item.productId && variantId === item.variantId,\r\n    );\r\n\r\n    const matchingCartItemIds = matchingCartItems.map(({ id }) => id);\r\n\r\n    return consignment.lineItemIds.find((id) => matchingCartItemIds.includes(id));\r\n}\r\n","import React, { FunctionComponent, memo, useMemo } from 'react';\r\n\r\nimport { TranslatedString } from '@bigcommerce/checkout/locale';\r\n\r\nimport { CheckboxFormField } from '../ui/form';\r\n\r\nexport interface BillingSameAsShippingFieldProps {\r\n    onChange?(isChecked: boolean): void;\r\n}\r\n\r\nconst BillingSameAsShippingField: FunctionComponent<BillingSameAsShippingFieldProps> = ({\r\n    onChange,\r\n}) => {\r\n    const labelContent = useMemo(\r\n        () => <TranslatedString id=\"billing.use_shipping_address_label\" />,\r\n        [],\r\n    );\r\n\r\n    return (\r\n        <CheckboxFormField\r\n            id=\"sameAsBilling\"\r\n            labelContent={labelContent}\r\n            name=\"billingSameAsShipping\"\r\n            onChange={onChange}\r\n        />\r\n    );\r\n};\r\n\r\nexport default memo(BillingSameAsShippingField);\r\n","import {\r\n    Address,\r\n    Consignment,\r\n    Country,\r\n    CustomerAddress,\r\n    FormField,\r\n} from '@bigcommerce/checkout-sdk';\r\nimport React, { Component, ReactNode } from 'react';\r\n\r\nimport { AddressForm, AddressSelect, isValidCustomerAddress } from '../address';\r\nimport { connectFormik, ConnectFormikProps } from '../common/form';\r\nimport { Fieldset } from '../ui/form';\r\nimport { LoadingOverlay } from '../ui/loading';\r\n\r\nimport { SingleShippingFormValues } from './SingleShippingForm';\r\n\r\nexport interface ShippingAddressFormProps {\r\n    addresses: CustomerAddress[];\r\n    address?: Address;\r\n    consignments: Consignment[];\r\n    countries?: Country[];\r\n    countriesWithAutocomplete: string[];\r\n    googleMapsApiKey?: string;\r\n    isLoading: boolean;\r\n    formFields: FormField[];\r\n    shouldShowSaveAddress?: boolean;\r\n    isFloatingLabelEnabled?: boolean;\r\n    onUseNewAddress(): void;\r\n    onFieldChange(fieldName: string, value: string): void;\r\n    onAddressSelect(address: Address): void;\r\n}\r\n\r\nconst addressFieldName = 'shippingAddress';\r\n\r\nclass ShippingAddressForm extends Component<\r\n    ShippingAddressFormProps & ConnectFormikProps<SingleShippingFormValues>\r\n> {\r\n    render(): ReactNode {\r\n        const {\r\n            addresses,\r\n            address: shippingAddress,\r\n            onAddressSelect,\r\n            onUseNewAddress,\r\n            shouldShowSaveAddress,\r\n            countries,\r\n            countriesWithAutocomplete,\r\n            formFields,\r\n            isLoading,\r\n            googleMapsApiKey,\r\n            isFloatingLabelEnabled,\r\n            formik: {\r\n                values: { shippingAddress: formAddress },\r\n            },\r\n        } = this.props;\r\n\r\n        const hasAddresses = addresses && addresses.length > 0;\r\n        const hasValidCustomerAddress = isValidCustomerAddress(\r\n            shippingAddress,\r\n            addresses,\r\n            formFields,\r\n        );\r\n\r\n        return (\r\n            <Fieldset id=\"checkoutShippingAddress\">\r\n                {hasAddresses && (\r\n                    <Fieldset id=\"shippingAddresses\">\r\n                        <LoadingOverlay isLoading={isLoading}>\r\n                            <AddressSelect\r\n                                addresses={addresses}\r\n                                onSelectAddress={onAddressSelect}\r\n                                onUseNewAddress={onUseNewAddress}\r\n                                selectedAddress={\r\n                                    hasValidCustomerAddress ? shippingAddress : undefined\r\n                                }\r\n                            />\r\n                        </LoadingOverlay>\r\n                    </Fieldset>\r\n                )}\r\n\r\n                {!hasValidCustomerAddress && (\r\n                    <LoadingOverlay isLoading={isLoading} unmountContentWhenLoading>\r\n                        <AddressForm\r\n                            countries={countries}\r\n                            countriesWithAutocomplete={countriesWithAutocomplete}\r\n                            countryCode={formAddress && formAddress.countryCode}\r\n                            fieldName={addressFieldName}\r\n                            formFields={formFields}\r\n                            googleMapsApiKey={googleMapsApiKey}\r\n                            isFloatingLabelEnabled={isFloatingLabelEnabled}\r\n                            onAutocompleteToggle={this.handleAutocompleteToggle}\r\n                            onChange={this.handleChange}\r\n                            setFieldValue={this.setFieldValue}\r\n                            shouldShowSaveAddress={shouldShowSaveAddress}\r\n                        />\r\n                    </LoadingOverlay>\r\n                )}\r\n            </Fieldset>\r\n        );\r\n    }\r\n\r\n    private setFieldValue: (fieldName: string, fieldValue: string) => void = (\r\n        fieldName,\r\n        fieldValue,\r\n    ) => {\r\n        const {\r\n            formik: { setFieldValue },\r\n            formFields,\r\n        } = this.props;\r\n\r\n        const customFormFieldNames = formFields\r\n            .filter((field) => field.custom)\r\n            .map((field) => field.name);\r\n\r\n        const formFieldName = customFormFieldNames.includes(fieldName)\r\n            ? `customFields.${fieldName}`\r\n            : fieldName;\r\n\r\n        setFieldValue(`${addressFieldName}.${formFieldName}`, fieldValue);\r\n    };\r\n\r\n    private handleChange: (fieldName: string, value: string) => void = (fieldName, value) => {\r\n        const { onFieldChange } = this.props;\r\n\r\n        onFieldChange(fieldName, value);\r\n    };\r\n\r\n    private handleAutocompleteToggle: (state: { inputValue: string; isOpen: boolean }) => void = ({\r\n        isOpen,\r\n        inputValue,\r\n    }) => {\r\n        const { onFieldChange } = this.props;\r\n\r\n        if (!isOpen) {\r\n            onFieldChange('address1', inputValue);\r\n        }\r\n    };\r\n}\r\n\r\nexport default connectFormik(ShippingAddressForm);\r\n","import {\r\n    Address,\r\n    CheckoutSelectors,\r\n    FormField,\r\n    ShippingInitializeOptions,\r\n    ShippingRequestOptions,\r\n} from '@bigcommerce/checkout-sdk';\r\nimport { noop } from 'lodash';\r\nimport React, { PureComponent, ReactNode } from 'react';\r\n\r\nimport { TranslatedString } from '@bigcommerce/checkout/locale';\r\n\r\nimport { StaticAddress } from '../address/';\r\nimport { preventDefault } from '../common/dom';\r\nimport { Button, ButtonSize, ButtonVariant } from '../ui/button';\r\nimport { DynamicFormField, Fieldset } from '../ui/form';\r\nimport { LoadingOverlay } from '../ui/loading';\r\n\r\nimport './StaticAddressEditable.scss';\r\n\r\nexport interface StaticAddressEditableProps {\r\n    address: Address;\r\n    buttonId: string;\r\n    formFields: FormField[];\r\n    isLoading: boolean;\r\n    methodId?: string;\r\n    deinitialize(options?: ShippingRequestOptions): Promise<CheckoutSelectors>;\r\n    initialize(options?: ShippingInitializeOptions): Promise<CheckoutSelectors>;\r\n    onFieldChange(fieldName: string, value: string): void;\r\n    onUnhandledError?(error: Error): void;\r\n}\r\n\r\nclass StaticAddressEditable extends PureComponent<StaticAddressEditableProps> {\r\n    async componentDidMount(): Promise<void> {\r\n        const { initialize, methodId, onUnhandledError = noop } = this.props;\r\n\r\n        try {\r\n            await initialize({ methodId });\r\n        } catch (error) {\r\n            onUnhandledError(error);\r\n        }\r\n    }\r\n\r\n    async componentWillUnmount(): Promise<void> {\r\n        const { deinitialize, methodId, onUnhandledError = noop } = this.props;\r\n\r\n        try {\r\n            await deinitialize({ methodId });\r\n        } catch (error) {\r\n            onUnhandledError(error);\r\n        }\r\n    }\r\n\r\n    render(): ReactNode {\r\n        const { address, buttonId, formFields, isLoading } = this.props;\r\n\r\n        const customFormFields = formFields.filter(({ custom }) => custom);\r\n        const shouldShowCustomFormFields = customFormFields.length > 0;\r\n\r\n        return (\r\n            <LoadingOverlay isLoading={isLoading}>\r\n                <div className=\"stepHeader\" style={{ padding: 0 }}>\r\n                    <div className=\"stepHeader-body subheader\">\r\n                        <StaticAddress address={address} />\r\n                    </div>\r\n\r\n                    <div className=\"stepHeader-actions subheader\">\r\n                        <Button\r\n                            id={buttonId}\r\n                            onClick={preventDefault()}\r\n                            size={ButtonSize.Tiny}\r\n                            testId=\"step-edit-button\"\r\n                            variant={ButtonVariant.Secondary}\r\n                        >\r\n                            <TranslatedString id=\"common.edit_action\" />\r\n                        </Button>\r\n                    </div>\r\n                </div>\r\n\r\n                {shouldShowCustomFormFields && (\r\n                    <Fieldset id=\"customFieldset\">\r\n                        {customFormFields.map((field) => (\r\n                            <DynamicFormField\r\n                                field={field}\r\n                                key={`${field.id}-${field.name}`}\r\n                                onChange={this.handleFieldValueChange(field.name)}\r\n                                parentFieldName=\"shippingAddress.customFields\"\r\n                            />\r\n                        ))}\r\n                    </Fieldset>\r\n                )}\r\n            </LoadingOverlay>\r\n        );\r\n    }\r\n\r\n    private handleFieldValueChange: (name: string) => (value: string) => void =\r\n        (name) => (value) => {\r\n            const { onFieldChange } = this.props;\r\n\r\n            onFieldChange(name, value);\r\n        };\r\n}\r\n\r\nexport default StaticAddressEditable;\r\n","import {\r\n    Address,\r\n    CheckoutSelectors,\r\n    Consignment,\r\n    Country,\r\n    CustomerAddress,\r\n    FormField,\r\n    ShippingInitializeOptions,\r\n    ShippingRequestOptions,\r\n} from '@bigcommerce/checkout-sdk';\r\nimport { memoizeOne } from '@bigcommerce/memoize';\r\nimport React, { FunctionComponent, memo, useCallback, useContext } from 'react';\r\n\r\nimport { FormContext } from '../ui/form';\r\n\r\nimport ShippingAddressForm from './ShippingAddressForm';\r\nimport StaticAddressEditable from './StaticAddressEditable';\r\n\r\nexport interface ShippingAddressProps {\r\n    addresses: CustomerAddress[];\r\n    consignments: Consignment[];\r\n    countries?: Country[];\r\n    countriesWithAutocomplete: string[];\r\n    formFields: FormField[];\r\n    googleMapsApiKey?: string;\r\n    isLoading: boolean;\r\n    isShippingStepPending: boolean;\r\n    methodId?: string;\r\n    shippingAddress?: Address;\r\n    shouldShowSaveAddress?: boolean;\r\n    hasRequestedShippingOptions: boolean;\r\n    isFloatingLabelEnabled?: boolean;\r\n    deinitialize(options: ShippingRequestOptions): Promise<CheckoutSelectors>;\r\n    initialize(options: ShippingInitializeOptions): Promise<CheckoutSelectors>;\r\n    onAddressSelect(address: Address): void;\r\n    onFieldChange(name: string, value: string): void;\r\n    onUnhandledError?(error: Error): void;\r\n    onUseNewAddress(): void;\r\n}\r\n\r\nconst ShippingAddress: FunctionComponent<ShippingAddressProps> = (props) => {\r\n    const {\r\n        methodId,\r\n        formFields,\r\n        countries,\r\n        countriesWithAutocomplete,\r\n        consignments,\r\n        googleMapsApiKey,\r\n        onAddressSelect,\r\n        onFieldChange,\r\n        onUseNewAddress,\r\n        initialize,\r\n        deinitialize,\r\n        isLoading,\r\n        shippingAddress,\r\n        hasRequestedShippingOptions,\r\n        addresses,\r\n        shouldShowSaveAddress,\r\n        isShippingStepPending,\r\n        isFloatingLabelEnabled,\r\n    } = props;\r\n\r\n    const { setSubmitted } = useContext(FormContext);\r\n\r\n    const initializeShipping = useCallback(\r\n        memoizeOne(\r\n            (defaultOptions: ShippingInitializeOptions) => (options?: ShippingInitializeOptions) =>\r\n                initialize({\r\n                    ...defaultOptions,\r\n                    ...options,\r\n                }),\r\n        ),\r\n        [],\r\n    );\r\n\r\n    const handleFieldChange: (fieldName: string, value: string) => void = (fieldName, value) => {\r\n        if (hasRequestedShippingOptions) {\r\n            setSubmitted(true);\r\n        }\r\n\r\n        onFieldChange(fieldName, value);\r\n    };\r\n\r\n    if (methodId) {\r\n        let options: ShippingInitializeOptions = {};\r\n\r\n        if (methodId === 'amazonpay' && shippingAddress) {\r\n            const editAddressButtonId = 'edit-ship-button';\r\n\r\n            options = {\r\n                amazonpay: {\r\n                    editAddressButtonId,\r\n                },\r\n            };\r\n\r\n            return (\r\n                <StaticAddressEditable\r\n                    address={shippingAddress}\r\n                    buttonId={editAddressButtonId}\r\n                    deinitialize={deinitialize}\r\n                    formFields={formFields}\r\n                    initialize={initializeShipping(options)}\r\n                    isLoading={isShippingStepPending}\r\n                    methodId={methodId}\r\n                    onFieldChange={onFieldChange}\r\n                />\r\n            );\r\n        }\r\n    }\r\n\r\n    return (\r\n        <ShippingAddressForm\r\n            address={shippingAddress}\r\n            addresses={addresses}\r\n            consignments={consignments}\r\n            countries={countries}\r\n            countriesWithAutocomplete={countriesWithAutocomplete}\r\n            formFields={formFields}\r\n            googleMapsApiKey={googleMapsApiKey}\r\n            isFloatingLabelEnabled={isFloatingLabelEnabled}\r\n            isLoading={isLoading}\r\n            onAddressSelect={onAddressSelect}\r\n            onFieldChange={handleFieldChange}\r\n            onUseNewAddress={onUseNewAddress}\r\n            shouldShowSaveAddress={shouldShowSaveAddress}\r\n        />\r\n    );\r\n};\r\n\r\nexport default memo(ShippingAddress);\r\n","export const SHIPPING_ADDRESS_FIELDS = [\r\n    'address1',\r\n    'postalCode',\r\n    'countryCode',\r\n    'city',\r\n    'stateOrProvince',\r\n    'stateOrProvinceCode',\r\n];\r\n","import {\r\n    Address,\r\n    CheckoutParams,\r\n    CheckoutSelectors,\r\n    Consignment,\r\n    Country,\r\n    CustomerAddress,\r\n    CustomerRequestOptions,\r\n    FormField,\r\n    RequestOptions,\r\n    ShippingInitializeOptions,\r\n    ShippingRequestOptions,\r\n} from '@bigcommerce/checkout-sdk';\r\nimport { FormikProps, withFormik } from 'formik';\r\nimport { debounce, isEqual, noop } from 'lodash';\r\nimport React, { PureComponent, ReactNode } from 'react';\r\nimport { lazy, object } from 'yup';\r\n\r\nimport { withLanguage, WithLanguageProps } from '@bigcommerce/checkout/locale';\r\n\r\nimport {\r\n    AddressFormValues,\r\n    getAddressFormFieldsValidationSchema,\r\n    getTranslateAddressError,\r\n    isEqualAddress,\r\n    mapAddressFromFormValues,\r\n    mapAddressToFormValues,\r\n} from '../address';\r\nimport { getCustomFormFieldsValidationSchema } from '../formFields';\r\nimport { Fieldset, Form, FormContext } from '../ui/form';\r\n\r\nimport BillingSameAsShippingField from './BillingSameAsShippingField';\r\nimport hasSelectedShippingOptions from './hasSelectedShippingOptions';\r\nimport ShippingAddress from './ShippingAddress';\r\nimport { SHIPPING_ADDRESS_FIELDS } from './ShippingAddressFields';\r\nimport ShippingFormFooter from './ShippingFormFooter';\r\n\r\nexport interface SingleShippingFormProps {\r\n    addresses: CustomerAddress[];\r\n    isBillingSameAsShipping: boolean;\r\n    cartHasChanged: boolean;\r\n    consignments: Consignment[];\r\n    countries: Country[];\r\n    countriesWithAutocomplete: string[];\r\n    customerMessage: string;\r\n    googleMapsApiKey?: string;\r\n    isLoading: boolean;\r\n    isShippingStepPending: boolean;\r\n    isMultiShippingMode: boolean;\r\n    methodId?: string;\r\n    shippingAddress?: Address;\r\n    shouldShowSaveAddress?: boolean;\r\n    shouldShowOrderComments: boolean;\r\n    isFloatingLabelEnabled?: boolean;\r\n    deinitialize(options: ShippingRequestOptions): Promise<CheckoutSelectors>;\r\n    deleteConsignments(): Promise<Address | undefined>;\r\n    getFields(countryCode?: string): FormField[];\r\n    initialize(options: ShippingInitializeOptions): Promise<CheckoutSelectors>;\r\n    onSubmit(values: SingleShippingFormValues): void;\r\n    onUnhandledError?(error: Error): void;\r\n    signOut(options?: CustomerRequestOptions): void;\r\n    updateAddress(\r\n        address: Partial<Address>,\r\n        options?: RequestOptions<CheckoutParams>,\r\n    ): Promise<CheckoutSelectors>;\r\n}\r\n\r\nexport interface SingleShippingFormValues {\r\n    billingSameAsShipping: boolean;\r\n    shippingAddress?: AddressFormValues;\r\n    orderComment: string;\r\n}\r\n\r\ninterface SingleShippingFormState {\r\n    isResettingAddress: boolean;\r\n    isUpdatingShippingData: boolean;\r\n    hasRequestedShippingOptions: boolean;\r\n}\r\n\r\nexport const SHIPPING_AUTOSAVE_DELAY = 1700;\r\n\r\nclass SingleShippingForm extends PureComponent<\r\n    SingleShippingFormProps & WithLanguageProps & FormikProps<SingleShippingFormValues>\r\n> {\r\n    static contextType = FormContext;\r\n\r\n    state: SingleShippingFormState = {\r\n        isResettingAddress: false,\r\n        isUpdatingShippingData: false,\r\n        hasRequestedShippingOptions: false,\r\n    };\r\n\r\n    private debouncedUpdateAddress: any;\r\n\r\n    constructor(\r\n        props: SingleShippingFormProps & WithLanguageProps & FormikProps<SingleShippingFormValues>,\r\n    ) {\r\n        super(props);\r\n\r\n        const { updateAddress } = this.props;\r\n\r\n        this.debouncedUpdateAddress = debounce(\r\n            async (address: Address, includeShippingOptions: boolean) => {\r\n                try {\r\n                    await updateAddress(address, {\r\n                        params: {\r\n                            include: {\r\n                                'consignments.availableShippingOptions': includeShippingOptions,\r\n                            },\r\n                        },\r\n                    });\r\n\r\n                    if (includeShippingOptions) {\r\n                        this.setState({ hasRequestedShippingOptions: true });\r\n                    }\r\n                } finally {\r\n                    this.setState({ isUpdatingShippingData: false });\r\n                }\r\n            },\r\n            SHIPPING_AUTOSAVE_DELAY,\r\n        );\r\n    }\r\n\r\n    render(): ReactNode {\r\n        const {\r\n            addresses,\r\n            cartHasChanged,\r\n            isLoading,\r\n            onUnhandledError,\r\n            methodId,\r\n            shouldShowSaveAddress,\r\n            countries,\r\n            countriesWithAutocomplete,\r\n            googleMapsApiKey,\r\n            shippingAddress,\r\n            consignments,\r\n            shouldShowOrderComments,\r\n            initialize,\r\n            isValid,\r\n            deinitialize,\r\n            values: { shippingAddress: addressForm },\r\n            isShippingStepPending,\r\n            isFloatingLabelEnabled,\r\n        } = this.props;\r\n\r\n        const { isResettingAddress, isUpdatingShippingData, hasRequestedShippingOptions } =\r\n            this.state;\r\n\r\n        const PAYMENT_METHOD_VALID = ['amazonpay'];\r\n        const shouldShowBillingSameAsShipping = !PAYMENT_METHOD_VALID.some(\r\n            (method) => method === methodId,\r\n        );\r\n\r\n        return (\r\n            <Form autoComplete=\"on\">\r\n                <Fieldset>\r\n                    <ShippingAddress\r\n                        addresses={addresses}\r\n                        consignments={consignments}\r\n                        countries={countries}\r\n                        countriesWithAutocomplete={countriesWithAutocomplete}\r\n                        deinitialize={deinitialize}\r\n                        formFields={this.getFields(addressForm && addressForm.countryCode)}\r\n                        googleMapsApiKey={googleMapsApiKey}\r\n                        hasRequestedShippingOptions={hasRequestedShippingOptions}\r\n                        initialize={initialize}\r\n                        isFloatingLabelEnabled={isFloatingLabelEnabled}\r\n                        isLoading={isResettingAddress}\r\n                        isShippingStepPending={isShippingStepPending}\r\n                        methodId={methodId}\r\n                        onAddressSelect={this.handleAddressSelect}\r\n                        onFieldChange={this.handleFieldChange}\r\n                        onUnhandledError={onUnhandledError}\r\n                        onUseNewAddress={this.onUseNewAddress}\r\n                        shippingAddress={shippingAddress}\r\n                        shouldShowSaveAddress={shouldShowSaveAddress}\r\n                    />\r\n                    {shouldShowBillingSameAsShipping && (\r\n                        <div className=\"form-body\">\r\n                            <BillingSameAsShippingField />\r\n                        </div>\r\n                    )}\r\n                </Fieldset>\r\n\r\n                <ShippingFormFooter\r\n                    cartHasChanged={cartHasChanged}\r\n                    isLoading={isLoading || isUpdatingShippingData}\r\n                    isMultiShippingMode={false}\r\n                    shouldDisableSubmit={this.shouldDisableSubmit()}\r\n                    shouldShowOrderComments={shouldShowOrderComments}\r\n                    shouldShowShippingOptions={isValid}\r\n                />\r\n            </Form>\r\n        );\r\n    }\r\n\r\n    private shouldDisableSubmit: () => boolean = () => {\r\n        const { isLoading, consignments, isValid } = this.props;\r\n\r\n        const { isUpdatingShippingData } = this.state;\r\n\r\n        if (!isValid) {\r\n            return false;\r\n        }\r\n\r\n        return isLoading || isUpdatingShippingData || !hasSelectedShippingOptions(consignments);\r\n    };\r\n\r\n    private handleFieldChange: (name: string) => void = async (name) => {\r\n        const { setFieldValue } = this.props;\r\n\r\n        if (name === 'countryCode') {\r\n            setFieldValue('shippingAddress.stateOrProvince', '');\r\n            setFieldValue('shippingAddress.stateOrProvinceCode', '');\r\n        }\r\n\r\n        // Enqueue the following code to run after Formik has run validation\r\n        await new Promise((resolve) => setTimeout(resolve));\r\n\r\n        const isShippingField = SHIPPING_ADDRESS_FIELDS.includes(name);\r\n\r\n        const { hasRequestedShippingOptions } = this.state;\r\n\r\n        const { isValid } = this.props;\r\n\r\n        if (!isValid) {\r\n            return;\r\n        }\r\n\r\n        this.updateAddressWithFormData(isShippingField || !hasRequestedShippingOptions);\r\n    };\r\n\r\n    private updateAddressWithFormData(includeShippingOptions: boolean) {\r\n        const {\r\n            shippingAddress,\r\n            values: { shippingAddress: addressForm },\r\n        } = this.props;\r\n\r\n        const updatedShippingAddress = addressForm && mapAddressFromFormValues(addressForm);\r\n\r\n        if (Array.isArray(shippingAddress?.customFields)) {\r\n            includeShippingOptions = !isEqual(\r\n                shippingAddress?.customFields,\r\n                updatedShippingAddress?.customFields\r\n            ) || includeShippingOptions;\r\n        }\r\n\r\n        if (!updatedShippingAddress || isEqualAddress(updatedShippingAddress, shippingAddress)) {\r\n            return;\r\n        }\r\n\r\n        this.setState({ isUpdatingShippingData: true });\r\n        this.debouncedUpdateAddress(updatedShippingAddress, includeShippingOptions);\r\n    }\r\n\r\n    private handleAddressSelect: (address: Address) => void = async (address) => {\r\n        const { updateAddress, onUnhandledError = noop, values, setValues } = this.props;\r\n\r\n        this.setState({ isResettingAddress: true });\r\n\r\n        try {\r\n            await updateAddress(address);\r\n\r\n            setValues({\r\n                ...values,\r\n                shippingAddress: mapAddressToFormValues(\r\n                    this.getFields(address.countryCode),\r\n                    address,\r\n                ),\r\n            });\r\n        } catch (error) {\r\n            onUnhandledError(error);\r\n        } finally {\r\n            this.setState({ isResettingAddress: false });\r\n        }\r\n    };\r\n\r\n    private onUseNewAddress: () => void = async () => {\r\n        const { deleteConsignments, onUnhandledError = noop, setValues, values } = this.props;\r\n\r\n        this.setState({ isResettingAddress: true });\r\n\r\n        try {\r\n            const address = await deleteConsignments();\r\n\r\n            setValues({\r\n                ...values,\r\n                shippingAddress: mapAddressToFormValues(\r\n                    this.getFields(address && address.countryCode),\r\n                    address,\r\n                ),\r\n            });\r\n        } catch (e) {\r\n            onUnhandledError(e);\r\n        } finally {\r\n            this.setState({ isResettingAddress: false });\r\n        }\r\n    };\r\n\r\n    private getFields(countryCode: string | undefined): FormField[] {\r\n        const { getFields } = this.props;\r\n\r\n        return getFields(countryCode);\r\n    }\r\n}\r\n\r\nexport default withLanguage(\r\n    withFormik<SingleShippingFormProps & WithLanguageProps, SingleShippingFormValues>({\r\n        handleSubmit: (values, { props: { onSubmit } }) => {\r\n            onSubmit(values);\r\n        },\r\n        mapPropsToValues: ({\r\n            getFields,\r\n            shippingAddress,\r\n            isBillingSameAsShipping,\r\n            customerMessage,\r\n        }) => ({\r\n            billingSameAsShipping: isBillingSameAsShipping,\r\n            orderComment: customerMessage,\r\n            shippingAddress: mapAddressToFormValues(\r\n                getFields(shippingAddress && shippingAddress.countryCode),\r\n                shippingAddress,\r\n            ),\r\n        }),\r\n        isInitialValid: ({ shippingAddress, getFields, language }) =>\r\n            !!shippingAddress &&\r\n            getAddressFormFieldsValidationSchema({\r\n                language,\r\n                formFields: getFields(shippingAddress.countryCode),\r\n            }).isValidSync(shippingAddress),\r\n        validationSchema: ({\r\n            language,\r\n            getFields,\r\n            methodId,\r\n        }: SingleShippingFormProps & WithLanguageProps) =>\r\n            methodId\r\n                ? object({\r\n                      shippingAddress: lazy<Partial<AddressFormValues>>((formValues) =>\r\n                          getCustomFormFieldsValidationSchema({\r\n                              translate: getTranslateAddressError(language),\r\n                              formFields: getFields(formValues && formValues.countryCode),\r\n                          }),\r\n                      ),\r\n                  })\r\n                : object({\r\n                      shippingAddress: lazy<Partial<AddressFormValues>>((formValues) =>\r\n                          getAddressFormFieldsValidationSchema({\r\n                              language,\r\n                              formFields: getFields(formValues && formValues.countryCode),\r\n                          }),\r\n                      ),\r\n                  }),\r\n        enableReinitialize: false,\r\n    })(SingleShippingForm),\r\n);\r\n","import {\r\n    Address,\r\n    AddressRequestBody,\r\n    Cart,\r\n    CheckoutParams,\r\n    CheckoutSelectors,\r\n    Consignment,\r\n    ConsignmentAssignmentRequestBody,\r\n    Country,\r\n    CustomerAddress,\r\n    CustomerRequestOptions,\r\n    FormField,\r\n    RequestOptions,\r\n    ShippingInitializeOptions,\r\n    ShippingRequestOptions,\r\n} from '@bigcommerce/checkout-sdk';\r\nimport React, { Component, ReactNode } from 'react';\r\n\r\nimport { withLanguage, WithLanguageProps } from '@bigcommerce/checkout/locale';\r\n\r\nimport MultiShippingForm, { MultiShippingFormValues } from './MultiShippingForm';\r\nimport SingleShippingForm, { SingleShippingFormValues } from './SingleShippingForm';\r\n\r\nexport interface ShippingFormProps {\r\n    addresses: CustomerAddress[];\r\n    cart: Cart;\r\n    cartHasChanged: boolean;\r\n    consignments: Consignment[];\r\n    countries: Country[];\r\n    countriesWithAutocomplete: string[];\r\n    customerMessage: string;\r\n    googleMapsApiKey?: string;\r\n    isBillingSameAsShipping: boolean;\r\n    isGuest: boolean;\r\n    isLoading: boolean;\r\n    isShippingStepPending: boolean;\r\n    isMultiShippingMode: boolean;\r\n    methodId?: string;\r\n    shippingAddress?: Address;\r\n    shouldShowSaveAddress?: boolean;\r\n    shouldShowOrderComments: boolean;\r\n    shouldShowAddAddressInCheckout: boolean;\r\n    isFloatingLabelEnabled?: boolean;\r\n    assignItem(consignment: ConsignmentAssignmentRequestBody): Promise<CheckoutSelectors>;\r\n    deinitialize(options: ShippingRequestOptions): Promise<CheckoutSelectors>;\r\n    deleteConsignments(): Promise<Address | undefined>;\r\n    getFields(countryCode?: string): FormField[];\r\n    initialize(options: ShippingInitializeOptions): Promise<CheckoutSelectors>;\r\n    onCreateAccount(): void;\r\n    createCustomerAddress(address: AddressRequestBody): Promise<CheckoutSelectors>;\r\n    onMultiShippingSubmit(values: MultiShippingFormValues): void;\r\n    onSignIn(): void;\r\n    onSingleShippingSubmit(values: SingleShippingFormValues): void;\r\n    onUnhandledError(error: Error): void;\r\n    onUseNewAddress(address: Address, itemId: string): void;\r\n    signOut(options?: CustomerRequestOptions): void;\r\n    updateAddress(\r\n        address: Partial<Address>,\r\n        options: RequestOptions<CheckoutParams>,\r\n    ): Promise<CheckoutSelectors>;\r\n}\r\n\r\nclass ShippingForm extends Component<ShippingFormProps & WithLanguageProps> {\r\n    render(): ReactNode {\r\n        const {\r\n            addresses,\r\n            assignItem,\r\n            cart,\r\n            cartHasChanged,\r\n            createCustomerAddress,\r\n            consignments,\r\n            countries,\r\n            countriesWithAutocomplete,\r\n            onCreateAccount,\r\n            customerMessage,\r\n            deinitialize,\r\n            deleteConsignments,\r\n            getFields,\r\n            googleMapsApiKey,\r\n            initialize,\r\n            isBillingSameAsShipping,\r\n            isGuest,\r\n            isLoading,\r\n            isMultiShippingMode,\r\n            methodId,\r\n            onMultiShippingSubmit,\r\n            onSignIn,\r\n            onSingleShippingSubmit,\r\n            onUnhandledError,\r\n            onUseNewAddress,\r\n            shippingAddress,\r\n            shouldShowOrderComments,\r\n            shouldShowSaveAddress,\r\n            shouldShowAddAddressInCheckout,\r\n            signOut,\r\n            updateAddress,\r\n            isShippingStepPending,\r\n            isFloatingLabelEnabled,\r\n        } = this.props;\r\n\r\n        return isMultiShippingMode ? (\r\n            <MultiShippingForm\r\n                addresses={addresses}\r\n                assignItem={assignItem}\r\n                cart={cart}\r\n                cartHasChanged={cartHasChanged}\r\n                consignments={consignments}\r\n                countries={countries}\r\n                countriesWithAutocomplete={countriesWithAutocomplete}\r\n                createCustomerAddress={createCustomerAddress}\r\n                customerMessage={customerMessage}\r\n                defaultCountryCode={shippingAddress?.countryCode}\r\n                getFields={getFields}\r\n                googleMapsApiKey={googleMapsApiKey}\r\n                isFloatingLabelEnabled={isFloatingLabelEnabled}\r\n                isGuest={isGuest}\r\n                isLoading={isLoading}\r\n                onCreateAccount={onCreateAccount}\r\n                onSignIn={onSignIn}\r\n                onSubmit={onMultiShippingSubmit}\r\n                onUnhandledError={onUnhandledError}\r\n                onUseNewAddress={onUseNewAddress}\r\n                shouldShowAddAddressInCheckout={shouldShowAddAddressInCheckout}\r\n                shouldShowOrderComments={shouldShowOrderComments}\r\n            />\r\n        ) : (\r\n            <SingleShippingForm\r\n                addresses={addresses}\r\n                cartHasChanged={cartHasChanged}\r\n                consignments={consignments}\r\n                countries={countries}\r\n                countriesWithAutocomplete={countriesWithAutocomplete}\r\n                customerMessage={customerMessage}\r\n                deinitialize={deinitialize}\r\n                deleteConsignments={deleteConsignments}\r\n                getFields={getFields}\r\n                googleMapsApiKey={googleMapsApiKey}\r\n                initialize={initialize}\r\n                isBillingSameAsShipping={isBillingSameAsShipping}\r\n                isFloatingLabelEnabled={isFloatingLabelEnabled}\r\n                isLoading={isLoading}\r\n                isMultiShippingMode={isMultiShippingMode}\r\n                isShippingStepPending={isShippingStepPending}\r\n                methodId={methodId}\r\n                onSubmit={onSingleShippingSubmit}\r\n                onUnhandledError={onUnhandledError}\r\n                shippingAddress={shippingAddress}\r\n                shouldShowOrderComments={shouldShowOrderComments}\r\n                shouldShowSaveAddress={shouldShowSaveAddress}\r\n                signOut={signOut}\r\n                updateAddress={updateAddress}\r\n            />\r\n        );\r\n    }\r\n}\r\n\r\nexport default withLanguage(ShippingForm);\r\n","import React, { FunctionComponent, memo } from 'react';\r\n\r\nimport { TranslatedString } from '@bigcommerce/checkout/locale';\r\n\r\nimport { preventDefault } from '../common/dom';\r\nimport { Legend } from '../ui/form';\r\n\r\ninterface ShippingHeaderProps {\r\n    isMultiShippingMode: boolean;\r\n    isGuest: boolean;\r\n    shouldShowMultiShipping: boolean;\r\n    onMultiShippingChange(): void;\r\n}\r\n\r\nconst ShippingHeader: FunctionComponent<ShippingHeaderProps> = ({\r\n    isMultiShippingMode,\r\n    isGuest,\r\n    onMultiShippingChange,\r\n    shouldShowMultiShipping,\r\n}) => (\r\n    <div className=\"form-legend-container\">\r\n        <Legend testId=\"shipping-address-heading\">\r\n            <TranslatedString\r\n                id={\r\n                    isMultiShippingMode\r\n                        ? isGuest\r\n                            ? 'shipping.multishipping_address_heading_guest'\r\n                            : 'shipping.multishipping_address_heading'\r\n                        : 'shipping.shipping_address_heading'\r\n                }\r\n            />\r\n        </Legend>\r\n\r\n        {shouldShowMultiShipping && (\r\n            <a\r\n                data-test=\"shipping-mode-toggle\"\r\n                href=\"#\"\r\n                onClick={preventDefault(onMultiShippingChange)}\r\n            >\r\n                <TranslatedString\r\n                    id={isMultiShippingMode ? 'shipping.ship_to_single' : 'shipping.ship_to_multi'}\r\n                />\r\n            </a>\r\n        )}\r\n    </div>\r\n);\r\n\r\nexport default memo(ShippingHeader);\r\n","import { CheckoutSelectors, ShippingInitializeOptions, ShippingRequestOptions } from '@bigcommerce/checkout-sdk';\r\nimport { noop } from 'lodash';\r\nimport React, { PureComponent, ReactNode } from 'react';\r\n\r\nexport interface StripeupeShippingAddressProps {\r\n    methodId?: string;\r\n    deinitialize(options?: ShippingRequestOptions): Promise<CheckoutSelectors>;\r\n    initialize(options?: ShippingInitializeOptions): Promise<CheckoutSelectors>;\r\n    onUnhandledError?(error: Error): void;\r\n}\r\n\r\nclass StripeShippingAddressDisplay extends PureComponent<StripeupeShippingAddressProps> {\r\n    async componentDidMount(): Promise<void> {\r\n        const {\r\n            initialize,\r\n            methodId,\r\n            onUnhandledError = noop,\r\n        } = this.props;\r\n\r\n        try {\r\n            await initialize({ methodId });\r\n        } catch (error) {\r\n            onUnhandledError(error);\r\n        }\r\n    }\r\n\r\n    async componentWillUnmount(): Promise<void> {\r\n        const {\r\n            deinitialize,\r\n            methodId,\r\n            onUnhandledError = noop,\r\n        } = this.props;\r\n\r\n        try {\r\n            await deinitialize({ methodId });\r\n        } catch (error) {\r\n            onUnhandledError(error);\r\n        }\r\n    }\r\n\r\n    render(): ReactNode {\r\n\r\n        return (\r\n            <>\r\n                <div className=\"stepHeader\" style={ { padding: 0 } }>\r\n                    <div id=\"StripeUpeShipping\" style={ { width: '100%' } } />\r\n                </div>\r\n                <br />\r\n            </>\r\n        );\r\n    }\r\n}\r\n\r\nexport default StripeShippingAddressDisplay;\r\n","interface StripeCountryMapping {\r\n    [key: string]: StripeStateMapping;\r\n}\r\n\r\ninterface StripeStateMapping {\r\n    [key: string]: string;\r\n}\r\n\r\nexport default function StripeStateMapper(country: string, state: string): string {\r\n\r\n    const countries: StripeCountryMapping = {\r\n        'MX': {\r\n            'Ags.': 'AGU',\r\n            'B.C.': 'BCN',\r\n            'B.C.S.': 'BCS',\r\n            'Camp.': 'CAM',\r\n            'Coah.': 'COA',\r\n            'Col.': 'COL',\r\n            'Chis.': 'CHP',\r\n            'Chih.': 'CHH',\r\n            'Dgo.': 'DUR',\r\n            'Gto.': 'GUA',\r\n            'Gro.': 'GRO',\r\n            'Hgo.': 'HID',\r\n            'Jal.': 'JAL',\r\n            'Méx.': 'MEX',\r\n            'CDMX': 'MEX',\r\n            'Mich.': 'MIC',\r\n            'Mor.': 'MOR',\r\n            'Nay.': 'NAY',\r\n            'N.L.': 'NLE',\r\n            'Oax.': 'OAX',\r\n            'Pue.': 'PUE',\r\n            'Qro.': 'QUE',\r\n            'Q.R.': 'ROO',\r\n            'S.L.P.': 'SLP',\r\n            'Sin.': 'SIN',\r\n            'Son.': 'SON',\r\n            'Tab.': 'TAB',\r\n            'Tamps.': 'TAM',\r\n            'Tlax.': 'TLA',\r\n            'Ver.': 'VER',\r\n            'Yuc.': 'YUC',\r\n            'Zac.': 'ZAC',\r\n        },\r\n        'AR': {\r\n            'Ciudad Autónoma de Buenos Aires': 'C',\r\n            'Buenos Aires': 'B',\r\n            'Catamarca': 'K',\r\n            'Chaco': 'H',\r\n            'Chubut': 'U',\r\n            'Córdoba': 'X',\r\n            'Corrientes': 'W',\r\n            'Entre Ríos': 'E',\r\n            'Formosa': 'P',\r\n            'Jujuy': 'Y',\r\n            'La Pampa': 'L',\r\n            'La Rioja': 'F',\r\n            'Mendoza': 'M',\r\n            'Misiones': 'N',\r\n            'Neuquén': 'Q',\r\n            'Salta': 'A',\r\n            'San Juan': 'J',\r\n            'San Luis': 'D',\r\n            'Santa Fe': 'S',\r\n            'Santiago del Estero': 'G',\r\n            'Tierra del Fuego': 'V',\r\n            'Tucumán': 'W',\r\n        },\r\n        'IN': {\r\n            'Andhra Pradesh': 'AP',\r\n            'Arunachal Pradesh': 'AR',\r\n            'Assam': 'AS',\r\n            'Bihar': 'BR',\r\n            'Chhattisgarh': 'CG',\r\n            'Goa': 'GA',\r\n            'Gujarat': 'GJ',\r\n            'Haryana': 'HR',\r\n            'Himachal Pradesh': 'HP',\r\n            'Jammu and Kashmir': 'JK',\r\n            'Jharkhand': 'JH',\r\n            'Karnataka': 'KA',\r\n            'Kerala': 'KL',\r\n            'Madhya Pradesh': 'MP',\r\n            'Maharashtra': 'MH',\r\n            'Manipur': 'MN',\r\n            'Meghalaya': 'ML',\r\n            'Mizoram': 'MZ',\r\n            'Nagaland': 'NL',\r\n            'Odisha': 'OR',\r\n            'Punjab': 'PB',\r\n            'Rajasthan': 'RJ',\r\n            'Sikkim': 'SK',\r\n            'Tamil Nadu': 'TN',\r\n            'Tripura': 'TR',\r\n            'Uttarakhand': 'UK',\r\n            'Uttar Pradesh': 'UP',\r\n            'West Bengal': 'WB',\r\n            'Andaman and Nicobar Islands': 'AN',\r\n            'Chandigarh': 'CH',\r\n            'Dadra and Nagar Haveli and Daman and Diu': 'DN',\r\n            'Lakshadweep': 'LD',\r\n            'Delhi': 'DL',\r\n            'Puducherry': 'PY',\r\n            'Telangana': 'TS',\r\n        },\r\n        'ID': {\r\n            'Bali': 'BA',\r\n            'Banten': 'BT',\r\n            'Bengkulu': 'BE',\r\n            'Aceh': 'DA',\r\n            'DKI Jakarta': 'JK',\r\n            'Sumatera Utara': 'SU',\r\n            'Sumatera Barat': 'SB',\r\n            'Riau': 'SI',\r\n            'Jambi': 'JA',\r\n            'Sumatera Selatan': 'SS',\r\n            'Lampung': 'LA',\r\n            'Jawa Barat': 'JB',\r\n            'Jawa Timur': 'JT',\r\n            'Daerah Istimewa Yogyakarta': 'DY',\r\n            'Kalimantan Barat': 'KB',\r\n            'Kalimantan Tengah': 'KT',\r\n            'Kalimantan Timur': 'KI',\r\n            'Kalimantan Selatan': 'KS',\r\n            'Nusa Tenggara Barat': 'NB',\r\n            'Nusa Tenggara Timur': 'NT',\r\n            'Sulawesi Selatan': 'SN',\r\n            'Sulawesi Tengah': 'ST',\r\n            'Sulawesi Utara': 'SA',\r\n            'Sulawesi Tenggara': 'SG',\r\n            'Maluku': 'MA',\r\n            'Maluku Utara': 'MU',\r\n            'Gorontalo': 'GO',\r\n        },\r\n        'MY': {\r\n            'Johor': 'JHR',\r\n            'Kedah': 'KDH',\r\n            'Kelantan': 'KTN',\r\n            'Melaka': 'MLK',\r\n            'Negeri Sembilan': 'NSN',\r\n            'Pahang': 'PHG',\r\n            'Pulau Pinang': 'PNG',\r\n            'Perak': 'PRK',\r\n            'Perlis': 'PLS',\r\n            'Selangor': 'SGR',\r\n            'Terengganu': 'TRG',\r\n            'Sabah': 'SBH',\r\n            'Sarawak': 'SRW',\r\n            'Kuala Lumpur': 'KUL',\r\n            'Labuan': 'LBN',\r\n            'Putrajaya': 'PJY',\r\n        },\r\n        'IE': {\r\n            'Carlow': 'CW',\r\n            'Cavan': 'CN',\r\n            'Clare': 'CE',\r\n            'Donegal': 'DL',\r\n            'Dublin': 'D',\r\n            'Galway': 'G',\r\n            'Kildare': 'KE',\r\n            'Kilkenny': 'KK',\r\n            'Laois': 'LS',\r\n            'Leitrim': 'LM',\r\n            'Longford': 'LD',\r\n            'Louth': 'LH',\r\n            'Mayo': 'MO',\r\n            'Meath': 'MH',\r\n            'Monaghan': 'MN',\r\n            'Offaly': 'OY',\r\n            'Roscommon': 'RN',\r\n            'Sligo': 'SO',\r\n            'Tipperary': 'TA',\r\n            'Waterford': 'WD',\r\n            'Westmeath': 'WH',\r\n            'Wexford': 'WX',\r\n            'Wicklow': 'WW',\r\n        },\r\n        'ES': {\r\n            'C': 'ACOR',\r\n            'VI': 'ALAV',\r\n            'AB': 'ALBA',\r\n            'A': 'ALIC',\r\n            'AL': 'ALME',\r\n            'O': 'ASTU',\r\n            'AV': 'AVIL',\r\n            'BA': 'BADA',\r\n            'PM': 'BALE',\r\n            'B': 'BARC',\r\n            'BU': 'BURG',\r\n            'CC': 'CACE',\r\n            'CA': 'CADI',\r\n            'S': 'CANT',\r\n            'CS': 'CAST',\r\n            'CE': 'CEUT',\r\n            'CR': 'CIUD',\r\n            'CO': 'CORD',\r\n            'CU': 'CUEN',\r\n            'GI': 'GIRO',\r\n            'GR': 'GRAN',\r\n            'GU': 'GUAD',\r\n            'SS': 'GUIP',\r\n            'H': 'HUEL',\r\n            'HU': 'HUES',\r\n            'J': 'JAEN',\r\n            'LO': 'LAR',\r\n            'GC': 'LAS',\r\n            'LE': 'LEON',\r\n            'L': 'LLEI',\r\n            'LU': 'LUGO',\r\n            'M': 'MADR',\r\n            'MA': 'MALA',\r\n            'ML': 'MELI',\r\n            'MU': 'MURC',\r\n            'NA': 'NAVA',\r\n            'OR': 'OURE',\r\n            'P': 'PALE',\r\n            'PO': 'PONT',\r\n            'SA': 'SALA',\r\n            'TF': 'SANT',\r\n            'SG': 'SEGO',\r\n            'SE': 'SEVI',\r\n            'SO': 'SORI',\r\n            'T': 'TARR',\r\n            'TE': 'TERU',\r\n            'TP': 'TOLE',\r\n            'V': 'VALE',\r\n            'VA': 'VALL',\r\n            'BI': 'VIZC',\r\n            'ZA': 'ZAMO',\r\n            'Z': 'ZARA',\r\n        }\r\n    };\r\n\r\n    if (countries[country]) {\r\n        return countries[country][state] ?? getStripeState(countries[country], state);\r\n    }\r\n\r\n    return state;\r\n}\r\n\r\nfunction getStripeState(stateList: StripeStateMapping, state: string) {\r\n    return Object.keys(stateList).find(key => stateList[key] === state) || state;\r\n}\r\n","import {\r\n    Address,\r\n    CheckoutSelectors,\r\n    Consignment,\r\n    Country,\r\n    ShippingInitializeOptions,\r\n    ShippingRequestOptions,\r\n    StripeShippingEvent\r\n} from '@bigcommerce/checkout-sdk';\r\nimport { memoizeOne } from '@bigcommerce/memoize';\r\nimport React, { FunctionComponent, memo, useCallback, useEffect, useState } from 'react';\r\n\r\nimport CheckoutStepStatus from '../../checkout/CheckoutStepStatus';\r\nimport { getAppliedStyles } from '../../common/dom';\r\nimport getRecommendedShippingOption from '../getRecommendedShippingOption';\r\nimport hasSelectedShippingOptions from '../hasSelectedShippingOptions';\r\nimport { SingleShippingFormValues } from '../SingleShippingForm';\r\n\r\nimport StripeShippingAddressDisplay from './StripeShippingAddressDisplay';\r\nimport StripeStateMapper from './StripeStateMapper';\r\n\r\nexport interface StripeShippingAddressProps {\r\n    consignments: Consignment[];\r\n    countries?: Country[];\r\n    shippingAddress?: Address;\r\n    step: CheckoutStepStatus;\r\n    isShippingMethodLoading: boolean;\r\n    shouldDisableSubmit: boolean;\r\n    isStripeLoading?(): void;\r\n    isStripeAutoStep?(): void;\r\n    deinitialize(options: ShippingRequestOptions): Promise<CheckoutSelectors>;\r\n    initialize(options: ShippingInitializeOptions): Promise<CheckoutSelectors>;\r\n    onAddressSelect(address: Address): void;\r\n    onSubmit(values: SingleShippingFormValues): void;\r\n}\r\n\r\nconst StripeShippingAddress: FunctionComponent<StripeShippingAddressProps> = (props) => {\r\n    const {\r\n        countries,\r\n        consignments,\r\n        onAddressSelect,\r\n        initialize,\r\n        deinitialize,\r\n        shouldDisableSubmit,\r\n        onSubmit,\r\n        step,\r\n        isStripeLoading,\r\n        isStripeAutoStep,\r\n        isShippingMethodLoading,\r\n        shippingAddress,\r\n    } = props;\r\n\r\n    const [isNewAddress, setIsNewAddress] = useState(true);\r\n    const [isFirstShippingRender, setIsFirstShippingRender] = useState(true);\r\n    const [stripeShippingAddress, setStripeShippingAddress] =  useState({\r\n        firstName: '',\r\n        lastName: '',\r\n        company: '',\r\n        address1: '',\r\n        address2: '',\r\n        city: '',\r\n        stateOrProvince: '',\r\n        stateOrProvinceCode: '',\r\n        shouldSaveAddress: true,\r\n        country: '',\r\n        countryCode: '',\r\n        postalCode: '',\r\n        phone: '',\r\n        customFields: [],\r\n    });\r\n\r\n    const handleLoading = useCallback(() => {\r\n        if (isStripeLoading) {\r\n            isStripeLoading();\r\n        }\r\n    }, [isStripeLoading]);\r\n\r\n    useEffect(() => {\r\n        if (consignments[0]) {\r\n            const {availableShippingOptions} = consignments[0];\r\n\r\n            if (availableShippingOptions && !getRecommendedShippingOption(availableShippingOptions)) {\r\n                handleLoading();\r\n            }\r\n        }\r\n    }, [consignments]);\r\n\r\n    useEffect(() => {\r\n        const hasStripeAddressAndHasShippingOptions = stripeShippingAddress.firstName && hasSelectedShippingOptions(consignments);\r\n        const afterReload = !isFirstShippingRender && !isNewAddress && !isShippingMethodLoading;\r\n        const isLoadingBeforeAutoStep =  isStripeLoading && isStripeAutoStep;\r\n\r\n        if (hasStripeAddressAndHasShippingOptions && afterReload && isLoadingBeforeAutoStep) {\r\n            isStripeLoading();\r\n            isStripeAutoStep();\r\n            onSubmit({billingSameAsShipping: true, shippingAddress: stripeShippingAddress, orderComment: ''});\r\n        }\r\n    }, [isFirstShippingRender, onSubmit, stripeShippingAddress, shouldDisableSubmit, isShippingMethodLoading, isNewAddress ,consignments]);\r\n\r\n    const availableShippingList = countries?.map(country => ({code: country.code, name: country.name}));\r\n    const allowedCountries = availableShippingList ? availableShippingList.map(country => country.code).join(', ') : '';\r\n    const shouldShowContent = (isNewAddress = true, phoneFieldRequired: boolean, phone: string) => {\r\n        const stepCompleted = step.isComplete;\r\n        const shippingPopulated = shippingAddress?.firstName && isNewAddress;\r\n        const PhoneRequiredAndNotFilled = phoneFieldRequired && !phone;\r\n\r\n        return stepCompleted || shippingPopulated || PhoneRequiredAndNotFilled;\r\n    };\r\n\r\n    const handleStripeShippingAddress = useCallback(async (shipping: StripeShippingEvent) => {\r\n        const {complete, phoneFieldRequired, value: { address = { country: '', state: '', line1: '', line2: '', city: '', postal_code: '' }\r\n            , name = '', firstName = '', lastName = '', phone = '' } } = shipping;\r\n\r\n        if (complete) {\r\n            if (shouldShowContent(shipping?.isNewAddress, phoneFieldRequired, phone)) {\r\n                handleLoading();\r\n            }\r\n\r\n            const names = name?.split(' ');\r\n\r\n            // @ts-ignore\r\n            const country = availableShippingList?.find(country => country.code === address.country).name;\r\n            const state = StripeStateMapper(address.country, address.state);\r\n            const shippingValue = {\r\n                firstName: firstName || names[0],\r\n                lastName: lastName || names[1],\r\n                company: '',\r\n                address1: address.line1,\r\n                address2: address.line2 || '',\r\n                city: address.city,\r\n                stateOrProvince: state,\r\n                stateOrProvinceCode: state,\r\n                shouldSaveAddress: true,\r\n                country: country || address.country,\r\n                countryCode: address.country,\r\n                postalCode: address.postal_code,\r\n                phone: phone || '',\r\n                customFields: [],\r\n            };\r\n\r\n            if (!step.isComplete) {\r\n                setIsFirstShippingRender(current => !current);\r\n            }\r\n\r\n            onAddressSelect(shippingValue);\r\n            setStripeShippingAddress(shippingValue);\r\n\r\n            if (shipping.isNewAddress !== isNewAddress) {\r\n                setIsNewAddress(current => !current);\r\n            }\r\n        } else {\r\n            handleLoading();\r\n        }\r\n\r\n    }, [availableShippingList, onAddressSelect]);\r\n\r\n    const initializeShipping = useCallback(\r\n        memoizeOne(\r\n            (defaultOptions: ShippingInitializeOptions) => (options?: ShippingInitializeOptions) =>\r\n                initialize({\r\n                    ...defaultOptions,\r\n                    ...options,\r\n                }),\r\n        ),\r\n        [],\r\n    );\r\n\r\n    const getStylesFromElement = (\r\n        id: string,\r\n        properties: string[]) => {\r\n        const parentContainer = document.getElementById(id);\r\n\r\n        if (parentContainer) {\r\n            return getAppliedStyles(parentContainer, properties);\r\n        }\r\n\r\n        return undefined;\r\n    };\r\n\r\n    const getStripeStyles: any = useCallback( () => {\r\n        const containerId = 'stripe-card-component-field';\r\n        const formInput = getStylesFromElement(`${containerId}--input`, ['color', 'background-color', 'border-color', 'box-shadow']);\r\n        const formLabel = getStylesFromElement(`${containerId}--label`, ['color']);\r\n        const formError = getStylesFromElement(`${containerId}--error`, ['color']);\r\n\r\n        return formLabel && formInput && formError ? {\r\n            labelText: formLabel.color,\r\n            fieldText: formInput.color,\r\n            fieldPlaceholderText: formInput.color,\r\n            fieldErrorText: formError.color,\r\n            fieldBackground: formInput['background-color'],\r\n            fieldInnerShadow: formInput['box-shadow'],\r\n            fieldBorder: formInput['border-color'],\r\n        } : undefined;\r\n    }, [])\r\n\r\n        const options: ShippingInitializeOptions = {\r\n            stripeupe: {\r\n                container: 'StripeUpeShipping',\r\n                onChangeShipping: handleStripeShippingAddress,\r\n                availableCountries: allowedCountries,\r\n                getStyles: getStripeStyles,\r\n                getStripeState: StripeStateMapper,\r\n                gatewayId: 'stripeupe',\r\n                methodId: 'card',\r\n            },\r\n        };\r\n\r\n        const renderCheckoutThemeStylesForStripeUPE = () => {\r\n            const containerId = 'stripe-card-component-field';\r\n\r\n            return (\r\n                <div\r\n                    className=\"optimizedCheckout-form-input\"\r\n                    id={ `${containerId}--input` }\r\n                    placeholder=\"1111\"\r\n                >\r\n                    <div\r\n                        className=\"form-field--error\"\r\n                    >\r\n                        <div\r\n                            className=\"optimizedCheckout-form-label\"\r\n                            id={ `${containerId}--error` }\r\n                        />\r\n                    </div>\r\n                    <div\r\n                        className=\"optimizedCheckout-form-label\"\r\n                        id={ `${containerId}--label` }\r\n                    />\r\n                </div>\r\n            );\r\n        };\r\n\r\n        return (\r\n            <>\r\n                <StripeShippingAddressDisplay\r\n                    deinitialize={ deinitialize }\r\n                    initialize={ initializeShipping(options) }\r\n                    methodId=\"stripeupe\"\r\n                />\r\n                { renderCheckoutThemeStylesForStripeUPE() }\r\n            </>\r\n        );\r\n};\r\n\r\nexport default memo(StripeShippingAddress);\r\n","import {\r\n    Address,\r\n    CheckoutParams,\r\n    CheckoutSelectors,\r\n    Consignment,\r\n    Country,\r\n    FormField,\r\n    RequestOptions,\r\n    ShippingInitializeOptions,\r\n    ShippingRequestOptions,\r\n} from '@bigcommerce/checkout-sdk';\r\nimport { FormikProps, withFormik } from 'formik';\r\nimport { noop } from 'lodash';\r\nimport React, { PureComponent, ReactNode } from 'react';\r\nimport { lazy, object } from 'yup';\r\n\r\nimport { withLanguage, WithLanguageProps } from '@bigcommerce/checkout/locale';\r\n\r\nimport {\r\n    AddressFormValues,\r\n    getAddressFormFieldsValidationSchema,\r\n    getTranslateAddressError,\r\n    mapAddressToFormValues,\r\n} from '../../address';\r\nimport CheckoutStepStatus from '../../checkout/CheckoutStepStatus';\r\nimport { getCustomFormFieldsValidationSchema } from '../../formFields';\r\nimport { Fieldset, Form, FormContext } from '../../ui/form';\r\nimport BillingSameAsShippingField from '../BillingSameAsShippingField';\r\nimport hasSelectedShippingOptions from '../hasSelectedShippingOptions';\r\nimport ShippingFormFooter from '../ShippingFormFooter';\r\n\r\nimport StripeShippingAddress from './StripeShippingAddress';\r\n\r\nexport interface SingleShippingFormProps {\r\n    isBillingSameAsShipping: boolean;\r\n    cartHasChanged: boolean;\r\n    consignments: Consignment[];\r\n    countries: Country[];\r\n    customerMessage: string;\r\n    isLoading: boolean;\r\n    isShippingMethodLoading: boolean;\r\n    isMultiShippingMode: boolean;\r\n    methodId?: string;\r\n    shippingAddress?: Address;\r\n    shouldShowOrderComments: boolean;\r\n    step: CheckoutStepStatus;\r\n    isStripeLoading?(): void;\r\n    isStripeAutoStep?(): void;\r\n    deinitialize(options: ShippingRequestOptions): Promise<CheckoutSelectors>;\r\n    getFields(countryCode?: string): FormField[];\r\n    initialize(options: ShippingInitializeOptions): Promise<CheckoutSelectors>;\r\n    onSubmit(values: SingleShippingFormValues): void;\r\n    onUnhandledError?(error: Error): void;\r\n    updateAddress(\r\n        address: Partial<Address>,\r\n        options?: RequestOptions<CheckoutParams>,\r\n    ): Promise<CheckoutSelectors>;\r\n}\r\n\r\nexport interface SingleShippingFormValues {\r\n    billingSameAsShipping: boolean;\r\n    shippingAddress?: AddressFormValues;\r\n    orderComment: string;\r\n}\r\n\r\ninterface SingleShippingFormState {\r\n    isUpdatingShippingData: boolean;\r\n}\r\n\r\nclass StripeShippingForm extends PureComponent<\r\n    SingleShippingFormProps & WithLanguageProps & FormikProps<SingleShippingFormValues>\r\n    > {\r\n    static contextType = FormContext;\r\n\r\n    state: SingleShippingFormState = {\r\n        isUpdatingShippingData: false,\r\n    };\r\n\r\n    render(): ReactNode {\r\n        const {\r\n            cartHasChanged,\r\n            isLoading,\r\n            countries,\r\n            isStripeLoading,\r\n            shippingAddress,\r\n            consignments,\r\n            shouldShowOrderComments,\r\n            initialize,\r\n            isValid,\r\n            deinitialize,\r\n            onSubmit,\r\n            isStripeAutoStep,\r\n            step,\r\n            isShippingMethodLoading,\r\n        } = this.props;\r\n\r\n        const { isUpdatingShippingData } = this.state;\r\n\r\n        return (\r\n            <Form autoComplete=\"on\">\r\n                <Fieldset>\r\n                    <StripeShippingAddress\r\n                        consignments={consignments}\r\n                        countries={countries}\r\n                        deinitialize={deinitialize}\r\n                        initialize={initialize}\r\n                        isShippingMethodLoading={isShippingMethodLoading}\r\n                        isStripeAutoStep={isStripeAutoStep}\r\n                        isStripeLoading={isStripeLoading}\r\n                        onAddressSelect={this.handleAddressSelect}\r\n                        onSubmit={onSubmit}\r\n                        shippingAddress={shippingAddress}\r\n                        shouldDisableSubmit={this.shouldDisableSubmit()}\r\n                        step={step}\r\n                    />\r\n                    <div className=\"form-body\">\r\n                        <BillingSameAsShippingField />\r\n                    </div>\r\n                </Fieldset>\r\n\r\n                <ShippingFormFooter\r\n                    cartHasChanged={cartHasChanged}\r\n                    isLoading={isLoading || isUpdatingShippingData}\r\n                    isMultiShippingMode={false}\r\n                    shouldDisableSubmit={this.shouldDisableSubmit()}\r\n                    shouldShowOrderComments={shouldShowOrderComments}\r\n                    shouldShowShippingOptions={isValid}\r\n                />\r\n            </Form>\r\n        );\r\n    }\r\n\r\n    private shouldDisableSubmit: () => boolean = () => {\r\n        const { isLoading, consignments, isValid } = this.props;\r\n\r\n        const { isUpdatingShippingData } = this.state;\r\n\r\n        if (!isValid) {\r\n            return false;\r\n        }\r\n\r\n        return isLoading || isUpdatingShippingData || !hasSelectedShippingOptions(consignments);\r\n    };\r\n\r\n    private handleAddressSelect: (address: Address) => void = async (address) => {\r\n        const { updateAddress, onUnhandledError = noop, values, setValues } = this.props;\r\n\r\n        try {\r\n            await updateAddress(address);\r\n\r\n            setValues({\r\n                ...values,\r\n                shippingAddress: mapAddressToFormValues(\r\n                    this.getFields(address.countryCode),\r\n                    address,\r\n                ),\r\n            });\r\n        } catch (error) {\r\n            onUnhandledError(error);\r\n        }\r\n    };\r\n\r\n    private getFields(countryCode: string | undefined): FormField[] {\r\n        const { getFields } = this.props;\r\n\r\n        return getFields(countryCode);\r\n    }\r\n}\r\n\r\nexport default withLanguage(\r\n    withFormik<SingleShippingFormProps & WithLanguageProps, SingleShippingFormValues>({\r\n        handleSubmit: (values, { props: { onSubmit } }) => {\r\n            onSubmit(values);\r\n        },\r\n        mapPropsToValues: ({\r\n                               getFields,\r\n                               shippingAddress,\r\n                               isBillingSameAsShipping,\r\n                               customerMessage,\r\n                           }) => ({\r\n            billingSameAsShipping: isBillingSameAsShipping,\r\n            orderComment: customerMessage,\r\n            shippingAddress: mapAddressToFormValues(\r\n                getFields(shippingAddress && shippingAddress.countryCode),\r\n                shippingAddress,\r\n            ),\r\n        }),\r\n        isInitialValid: ({ shippingAddress, getFields, language }) =>\r\n            !!shippingAddress &&\r\n            getAddressFormFieldsValidationSchema({\r\n                language,\r\n                formFields: getFields(shippingAddress.countryCode),\r\n            }).isValidSync(shippingAddress),\r\n        validationSchema: ({\r\n                               language,\r\n                               getFields,\r\n                               methodId,\r\n                           }: SingleShippingFormProps & WithLanguageProps) =>\r\n            methodId\r\n                ? object({\r\n                    shippingAddress: lazy<Partial<AddressFormValues>>((formValues) =>\r\n                        getCustomFormFieldsValidationSchema({\r\n                            translate: getTranslateAddressError(language),\r\n                            formFields: getFields(formValues && formValues.countryCode),\r\n                        }),\r\n                    ),\r\n                })\r\n                : object({\r\n                    shippingAddress: lazy<Partial<AddressFormValues>>((formValues) =>\r\n                        getAddressFormFieldsValidationSchema({\r\n                            language,\r\n                            formFields: getFields(formValues && formValues.countryCode),\r\n                        }),\r\n                    ),\r\n                }),\r\n        enableReinitialize: false,\r\n    })(StripeShippingForm),\r\n);\r\n","import { Address, CheckoutSelectors, Consignment, Country, Customer, FormField, ShippingInitializeOptions, ShippingRequestOptions } from '@bigcommerce/checkout-sdk';\r\nimport React, { Component, ReactNode } from 'react';\r\n\r\nimport { AddressFormSkeleton } from '@bigcommerce/checkout/ui';\r\n\r\nimport CheckoutStepStatus from '../../checkout/CheckoutStepStatus';\r\nimport ShippingHeader from '../ShippingHeader';\r\n\r\nimport StripeShippingForm, { SingleShippingFormValues } from './StripeShippingForm';\r\n\r\nexport interface StripeShippingProps {\r\n    isBillingSameAsShipping: boolean;\r\n    cartHasChanged: boolean;\r\n    isMultiShippingMode: boolean;\r\n    step: CheckoutStepStatus;\r\n    consignments: Consignment[];\r\n    countries: Country[];\r\n    customer: Customer;\r\n    customerMessage: string;\r\n    isGuest: boolean;\r\n    isInitializing: boolean;\r\n    isLoading: boolean;\r\n    isShippingMethodLoading: boolean;\r\n    isShippingStepPending: boolean;\r\n    methodId?: string;\r\n    shippingAddress?: Address;\r\n    shouldShowAddAddressInCheckout: boolean;\r\n    shouldShowMultiShipping: boolean;\r\n    shouldShowOrderComments: boolean;\r\n    onReady?(): void;\r\n    onUnhandledError(error: Error): void;\r\n    onSubmit(values: SingleShippingFormValues): void;\r\n    onMultiShippingChange(): void;\r\n    deinitialize(options: ShippingRequestOptions): Promise<CheckoutSelectors>;\r\n    initialize(options: ShippingInitializeOptions): Promise<CheckoutSelectors>;\r\n    loadShippingAddressFields(): Promise<CheckoutSelectors>;\r\n    loadShippingOptions(): Promise<CheckoutSelectors>;\r\n    updateAddress(address: Partial<Address>): Promise<CheckoutSelectors>;\r\n    getFields(countryCode?: string): FormField[];\r\n}\r\n\r\ninterface StripeShippingState {\r\n    isStripeLoading: boolean;\r\n    isStripeAutoStep: boolean;\r\n}\r\n\r\nclass StripeShipping extends Component<StripeShippingProps, StripeShippingState> {\r\n    constructor(props: StripeShippingProps) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            isStripeLoading: true,\r\n            isStripeAutoStep: false,\r\n        };\r\n    }\r\n\r\n    render(): ReactNode {\r\n        const {\r\n            isBillingSameAsShipping,\r\n            isGuest,\r\n            shouldShowMultiShipping,\r\n            customer,\r\n            updateAddress,\r\n            initialize,\r\n            deinitialize,\r\n            isMultiShippingMode,\r\n            step,\r\n            onSubmit,\r\n            onMultiShippingChange,\r\n            isLoading,\r\n            isShippingMethodLoading,\r\n            ...shippingFormProps\r\n        } = this.props;\r\n\r\n        const {\r\n            isStripeLoading,\r\n            isStripeAutoStep,\r\n        } = this.state;\r\n\r\n        return <>\r\n            <AddressFormSkeleton isLoading={isStripeAutoStep || isStripeLoading}/>\r\n            <div className=\"checkout-form\" style={{display: isStripeAutoStep || isStripeLoading ? 'none' : undefined}}>\r\n                <ShippingHeader\r\n                    isGuest={isGuest}\r\n                    isMultiShippingMode={isMultiShippingMode}\r\n                    onMultiShippingChange={onMultiShippingChange}\r\n                    shouldShowMultiShipping={shouldShowMultiShipping}\r\n                />\r\n                <StripeShippingForm\r\n                    {...shippingFormProps}\r\n                    deinitialize={deinitialize}\r\n                    initialize={initialize}\r\n                    isBillingSameAsShipping={isBillingSameAsShipping}\r\n                    isLoading={isLoading}\r\n                    isMultiShippingMode={isMultiShippingMode}\r\n                    isShippingMethodLoading={isShippingMethodLoading}\r\n                    isStripeAutoStep={this.handleIsAutoStep}\r\n                    isStripeLoading={this.stripeLoadedCallback}\r\n                    onSubmit={onSubmit}\r\n                    step={step}\r\n                    updateAddress={updateAddress}\r\n                />\r\n            </div>\r\n        </>;\r\n    }\r\n\r\n    private stripeLoadedCallback: () => void = () => {\r\n        this.setState({ isStripeLoading: false });\r\n    }\r\n\r\n    private handleIsAutoStep: () => void = () => {\r\n        this.setState({ isStripeAutoStep: true });\r\n    }\r\n}\r\n\r\nexport default StripeShipping;\r\n","import {\r\n    Address,\r\n    AddressRequestBody,\r\n    Cart,\r\n    CheckoutRequestBody,\r\n    CheckoutSelectors,\r\n    Consignment,\r\n    ConsignmentAssignmentRequestBody,\r\n    Country,\r\n    Customer,\r\n    CustomerRequestOptions,\r\n    FormField,\r\n    ShippingInitializeOptions,\r\n    ShippingRequestOptions,\r\n} from '@bigcommerce/checkout-sdk';\r\nimport { noop } from 'lodash';\r\nimport React, { Component, ReactNode } from 'react';\r\nimport { createSelector } from 'reselect';\r\n\r\nimport { CheckoutContextProps } from '@bigcommerce/checkout/payment-integration-api';\r\nimport { AddressFormSkeleton } from '@bigcommerce/checkout/ui';\r\n\r\nimport { isEqualAddress, mapAddressFromFormValues } from '../address';\r\nimport { withCheckout } from '../checkout';\r\nimport CheckoutStepStatus from '../checkout/CheckoutStepStatus';\r\nimport { EMPTY_ARRAY, isFloatingLabelEnabled } from '../common/utility';\r\nimport { PaymentMethodId } from '../payment/paymentMethod';\r\n\r\nimport { UnassignItemError } from './errors';\r\nimport getShippableItemsCount from './getShippableItemsCount';\r\nimport getShippingMethodId from './getShippingMethodId';\r\nimport { MultiShippingFormValues } from './MultiShippingForm';\r\nimport ShippingForm from './ShippingForm';\r\nimport ShippingHeader from './ShippingHeader';\r\nimport { SingleShippingFormValues } from './SingleShippingForm';\r\nimport StripeShipping from './stripeUPE/StripeShipping';\r\n\r\nexport interface ShippingProps {\r\n    isBillingSameAsShipping: boolean;\r\n    cartHasChanged: boolean;\r\n    isMultiShippingMode: boolean;\r\n    step: CheckoutStepStatus;\r\n    onCreateAccount(): void;\r\n    onToggleMultiShipping(): void;\r\n    onReady?(): void;\r\n    onUnhandledError(error: Error): void;\r\n    onSignIn(): void;\r\n    navigateNextStep(isBillingSameAsShipping: boolean): void;\r\n}\r\n\r\nexport interface WithCheckoutShippingProps {\r\n    billingAddress?: Address;\r\n    cart: Cart;\r\n    consignments: Consignment[];\r\n    countries: Country[];\r\n    countriesWithAutocomplete: string[];\r\n    customer: Customer;\r\n    customerMessage: string;\r\n    googleMapsApiKey: string;\r\n    isGuest: boolean;\r\n    isInitializing: boolean;\r\n    isLoading: boolean;\r\n    isShippingStepPending: boolean;\r\n    methodId?: string;\r\n    shippingAddress?: Address;\r\n    shouldShowAddAddressInCheckout: boolean;\r\n    shouldShowMultiShipping: boolean;\r\n    shouldShowOrderComments: boolean;\r\n    providerWithCustomCheckout?: string;\r\n    isFloatingLabelEnabled?: boolean;\r\n    assignItem(consignment: ConsignmentAssignmentRequestBody): Promise<CheckoutSelectors>;\r\n    deinitializeShippingMethod(options: ShippingRequestOptions): Promise<CheckoutSelectors>;\r\n    deleteConsignments(): Promise<Address | undefined>;\r\n    getFields(countryCode?: string): FormField[];\r\n    initializeShippingMethod(options: ShippingInitializeOptions): Promise<CheckoutSelectors>;\r\n    loadShippingAddressFields(): Promise<CheckoutSelectors>;\r\n    loadShippingOptions(): Promise<CheckoutSelectors>;\r\n    signOut(options?: CustomerRequestOptions): void;\r\n    createCustomerAddress(address: AddressRequestBody): Promise<CheckoutSelectors>;\r\n    unassignItem(consignment: ConsignmentAssignmentRequestBody): Promise<CheckoutSelectors>;\r\n    updateBillingAddress(address: Partial<Address>): Promise<CheckoutSelectors>;\r\n    updateCheckout(payload: CheckoutRequestBody): Promise<CheckoutSelectors>;\r\n    updateShippingAddress(address: Partial<Address>): Promise<CheckoutSelectors>;\r\n}\r\n\r\ninterface ShippingState {\r\n    isInitializing: boolean;\r\n}\r\n\r\nclass Shipping extends Component<ShippingProps & WithCheckoutShippingProps, ShippingState> {\r\n    constructor(props: ShippingProps & WithCheckoutShippingProps) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            isInitializing: true,\r\n        };\r\n    }\r\n\r\n    async componentDidMount(): Promise<void> {\r\n        const {\r\n            loadShippingAddressFields,\r\n            loadShippingOptions,\r\n            onReady = noop,\r\n            onUnhandledError = noop,\r\n        } = this.props;\r\n\r\n        try {\r\n            await Promise.all([loadShippingAddressFields(), loadShippingOptions()]);\r\n\r\n            onReady();\r\n        } catch (error) {\r\n            onUnhandledError(error);\r\n        } finally {\r\n            this.setState({ isInitializing: false });\r\n        }\r\n    }\r\n\r\n    render(): ReactNode {\r\n        const {\r\n            isBillingSameAsShipping,\r\n            isGuest,\r\n            shouldShowMultiShipping,\r\n            customer,\r\n            unassignItem,\r\n            updateShippingAddress,\r\n            initializeShippingMethod,\r\n            deinitializeShippingMethod,\r\n            isMultiShippingMode,\r\n            onToggleMultiShipping,\r\n            providerWithCustomCheckout,\r\n            step,\r\n            isFloatingLabelEnabled,\r\n            ...shippingFormProps\r\n        } = this.props;\r\n\r\n        const {\r\n            isInitializing,\r\n        } = this.state;\r\n\r\n        if (providerWithCustomCheckout === PaymentMethodId.StripeUPE && !customer.email && this.props.countries.length > 0) {\r\n            return <StripeShipping\r\n                { ...shippingFormProps }\r\n                customer={ customer }\r\n                deinitialize={deinitializeShippingMethod}\r\n                initialize={initializeShippingMethod}\r\n                isBillingSameAsShipping={isBillingSameAsShipping}\r\n                isGuest={ isGuest }\r\n                isLoading={ isInitializing }\r\n                isMultiShippingMode={isMultiShippingMode}\r\n                isShippingMethodLoading={ this.props.isLoading }\r\n                onMultiShippingChange={ this.handleMultiShippingModeSwitch }\r\n                onSubmit={this.handleSingleShippingSubmit}\r\n                shouldShowMultiShipping={ shouldShowMultiShipping }\r\n                step={step}\r\n                updateAddress={updateShippingAddress}\r\n            />;\r\n        }\r\n\r\n        return (\r\n            <AddressFormSkeleton isLoading={isInitializing}>\r\n                <div className=\"checkout-form\">\r\n                    <ShippingHeader\r\n                        isGuest={isGuest}\r\n                        isMultiShippingMode={isMultiShippingMode}\r\n                        onMultiShippingChange={this.handleMultiShippingModeSwitch}\r\n                        shouldShowMultiShipping={shouldShowMultiShipping}\r\n                    />\r\n                    <ShippingForm\r\n                        {...shippingFormProps}\r\n                        addresses={customer.addresses}\r\n                        deinitialize={deinitializeShippingMethod}\r\n                        initialize={initializeShippingMethod}\r\n                        isBillingSameAsShipping={isBillingSameAsShipping}\r\n                        isFloatingLabelEnabled={isFloatingLabelEnabled}\r\n                        isGuest={isGuest}\r\n                        isMultiShippingMode={isMultiShippingMode}\r\n                        onMultiShippingSubmit={this.handleMultiShippingSubmit}\r\n                        onSingleShippingSubmit={this.handleSingleShippingSubmit}\r\n                        onUseNewAddress={this.handleUseNewAddress}\r\n                        shouldShowSaveAddress={!isGuest}\r\n                        updateAddress={updateShippingAddress}\r\n                    />\r\n                </div>\r\n            </AddressFormSkeleton>\r\n        );\r\n    }\r\n\r\n    private handleMultiShippingModeSwitch: () => void = async () => {\r\n        const {\r\n            consignments,\r\n            isMultiShippingMode,\r\n            onToggleMultiShipping = noop,\r\n            onUnhandledError = noop,\r\n            updateShippingAddress,\r\n        } = this.props;\r\n\r\n        if (isMultiShippingMode && consignments.length > 1) {\r\n            this.setState({ isInitializing: true });\r\n\r\n            try {\r\n                // Collapse all consignments into one\r\n                await updateShippingAddress(consignments[0].shippingAddress);\r\n            } catch (error) {\r\n                onUnhandledError(error);\r\n            } finally {\r\n                this.setState({ isInitializing: false });\r\n            }\r\n        }\r\n\r\n        onToggleMultiShipping();\r\n    };\r\n\r\n    private handleSingleShippingSubmit: (values: SingleShippingFormValues) => void = async ({\r\n        billingSameAsShipping,\r\n        shippingAddress: addressValues,\r\n        orderComment,\r\n    }) => {\r\n        const {\r\n            customerMessage,\r\n            updateCheckout,\r\n            updateShippingAddress,\r\n            updateBillingAddress,\r\n            navigateNextStep,\r\n            onUnhandledError,\r\n            shippingAddress,\r\n            billingAddress,\r\n            methodId,\r\n        } = this.props;\r\n\r\n        const updatedShippingAddress = addressValues && mapAddressFromFormValues(addressValues);\r\n        const promises: Array<Promise<CheckoutSelectors>> = [];\r\n        const hasRemoteBilling = this.hasRemoteBilling(methodId);\r\n\r\n        if (!isEqualAddress(updatedShippingAddress, shippingAddress) || shippingAddress?.shouldSaveAddress !== updatedShippingAddress?.shouldSaveAddress) {\r\n            promises.push(updateShippingAddress(updatedShippingAddress || {}));\r\n        }\r\n\r\n        if (\r\n            billingSameAsShipping &&\r\n            updatedShippingAddress &&\r\n            !isEqualAddress(updatedShippingAddress, billingAddress) &&\r\n            !hasRemoteBilling\r\n        ) {\r\n            promises.push(updateBillingAddress(updatedShippingAddress));\r\n        }\r\n\r\n        if (customerMessage !== orderComment) {\r\n            promises.push(updateCheckout({ customerMessage: orderComment }));\r\n        }\r\n\r\n        try {\r\n            await Promise.all(promises);\r\n\r\n            navigateNextStep(billingSameAsShipping);\r\n        } catch (error) {\r\n            if (error instanceof Error) {\r\n                onUnhandledError(error);\r\n            }\r\n        }\r\n    };\r\n\r\n    private hasRemoteBilling: (methodId?: string) => boolean = (methodId) => {\r\n        const PAYMENT_METHOD_VALID = ['amazonpay'];\r\n\r\n        return PAYMENT_METHOD_VALID.some((method) => method === methodId);\r\n    };\r\n\r\n    private handleUseNewAddress: (address: Address, itemId: string) => void = async (\r\n        address,\r\n        itemId,\r\n    ) => {\r\n        const { unassignItem, onUnhandledError } = this.props;\r\n\r\n        try {\r\n            await unassignItem({\r\n                address,\r\n                lineItems: [\r\n                    {\r\n                        quantity: 1,\r\n                        itemId,\r\n                    },\r\n                ],\r\n            });\r\n\r\n            location.href = '/account.php?action=add_shipping_address&from=checkout';\r\n        } catch (error) {\r\n            if (error instanceof UnassignItemError) {\r\n                onUnhandledError(new UnassignItemError(error));\r\n            }\r\n        }\r\n    };\r\n\r\n    private handleMultiShippingSubmit: (values: MultiShippingFormValues) => void = async ({\r\n        orderComment,\r\n    }) => {\r\n        const { customerMessage, updateCheckout, navigateNextStep, onUnhandledError } = this.props;\r\n\r\n        try {\r\n            if (customerMessage !== orderComment) {\r\n                await updateCheckout({ customerMessage: orderComment });\r\n            }\r\n\r\n            navigateNextStep(false);\r\n        } catch (error) {\r\n            if (error instanceof Error) {\r\n                onUnhandledError(error);\r\n            }\r\n        }\r\n    };\r\n}\r\n\r\nconst deleteConsignmentsSelector = createSelector(\r\n    ({ checkoutService: { deleteConsignment } }: CheckoutContextProps) => deleteConsignment,\r\n    ({ checkoutState: { data } }: CheckoutContextProps) => data.getConsignments(),\r\n    (deleteConsignment, consignments) => async () => {\r\n        if (!consignments || !consignments.length) {\r\n            return;\r\n        }\r\n\r\n        const [{ data }] = await Promise.all(consignments.map(({ id }) => deleteConsignment(id)));\r\n\r\n        return data.getShippingAddress();\r\n    },\r\n);\r\n\r\n// tslint:disable-next-line:cyclomatic-complexity\r\nexport function mapToShippingProps({\r\n    checkoutService,\r\n    checkoutState,\r\n}: CheckoutContextProps): WithCheckoutShippingProps | null {\r\n    const {\r\n        data: {\r\n            getCart,\r\n            getCheckout,\r\n            getConfig,\r\n            getCustomer,\r\n            getConsignments,\r\n            getShippingAddress,\r\n            getBillingAddress,\r\n            getShippingAddressFields,\r\n            getShippingCountries,\r\n        },\r\n        statuses: {\r\n            isShippingStepPending,\r\n            isSelectingShippingOption,\r\n            isLoadingShippingOptions,\r\n            isUpdatingConsignment,\r\n            isCreatingConsignments,\r\n            isCreatingCustomerAddress,\r\n            isLoadingShippingCountries,\r\n            isUpdatingBillingAddress,\r\n            isUpdatingCheckout,\r\n        },\r\n    } = checkoutState;\r\n\r\n    const checkout = getCheckout();\r\n    const config = getConfig();\r\n    const consignments = getConsignments() || [];\r\n    const customer = getCustomer();\r\n    const cart = getCart();\r\n\r\n    if (!checkout || !config || !customer || !cart) {\r\n        return null;\r\n    }\r\n\r\n    const {\r\n        checkoutSettings: {\r\n            enableOrderComments,\r\n            features,\r\n            hasMultiShippingEnabled,\r\n            googleMapsApiKey,\r\n        },\r\n    } = config;\r\n\r\n    const methodId = getShippingMethodId(checkout);\r\n    const shippableItemsCount = getShippableItemsCount(cart);\r\n    const isLoading =\r\n        isLoadingShippingOptions() ||\r\n        isSelectingShippingOption() ||\r\n        isUpdatingConsignment() ||\r\n        isCreatingConsignments() ||\r\n        isUpdatingBillingAddress() ||\r\n        isUpdatingCheckout() ||\r\n        isCreatingCustomerAddress();\r\n    const shouldShowMultiShipping =\r\n        hasMultiShippingEnabled && !methodId && shippableItemsCount > 1 && shippableItemsCount < 50;\r\n    const countriesWithAutocomplete = ['US', 'CA', 'AU', 'NZ'];\r\n\r\n    if (features['CHECKOUT-4183.checkout_google_address_autocomplete_uk']) {\r\n        countriesWithAutocomplete.push('GB');\r\n    }\r\n\r\n    const shippingAddress =\r\n        !shouldShowMultiShipping && consignments.length > 1 ? undefined : getShippingAddress();\r\n\r\n    return {\r\n        assignItem: checkoutService.assignItemsToAddress,\r\n        billingAddress: getBillingAddress(),\r\n        cart,\r\n        consignments,\r\n        countries: getShippingCountries() || EMPTY_ARRAY,\r\n        countriesWithAutocomplete,\r\n        customer,\r\n        customerMessage: checkout.customerMessage,\r\n        createCustomerAddress: checkoutService.createCustomerAddress,\r\n        deinitializeShippingMethod: checkoutService.deinitializeShipping,\r\n        deleteConsignments: deleteConsignmentsSelector({ checkoutService, checkoutState }),\r\n        getFields: getShippingAddressFields,\r\n        googleMapsApiKey,\r\n        initializeShippingMethod: checkoutService.initializeShipping,\r\n        isGuest: customer.isGuest,\r\n        isInitializing: isLoadingShippingCountries() || isLoadingShippingOptions(),\r\n        isLoading,\r\n        isShippingStepPending: isShippingStepPending(),\r\n        loadShippingAddressFields: checkoutService.loadShippingAddressFields,\r\n        loadShippingOptions: checkoutService.loadShippingOptions,\r\n        methodId,\r\n        providerWithCustomCheckout: config.checkoutSettings.providerWithCustomCheckout || undefined,\r\n        shippingAddress,\r\n        shouldShowMultiShipping,\r\n        shouldShowAddAddressInCheckout:\r\n            features['CHECKOUT-4726.add_address_in_multishipping_checkout'],\r\n        shouldShowOrderComments: enableOrderComments,\r\n        signOut: checkoutService.signOutCustomer,\r\n        unassignItem: checkoutService.unassignItemsToAddress,\r\n        updateBillingAddress: checkoutService.updateBillingAddress,\r\n        updateCheckout: checkoutService.updateCheckout,\r\n        updateShippingAddress: checkoutService.updateShippingAddress,\r\n        isFloatingLabelEnabled: isFloatingLabelEnabled(config.checkoutSettings),\r\n    };\r\n}\r\n\r\nexport default withCheckout(mapToShippingProps)(Shipping);\r\n","import { noop } from 'lodash';\r\nimport { createContext } from 'react';\r\n\r\nexport interface AccordionContextProps {\r\n    selectedItemId?: string;\r\n    onToggle(id: string): void;\r\n}\r\n\r\nconst AccordionContext = createContext<AccordionContextProps>({ onToggle: noop });\r\n\r\nexport default AccordionContext;\r\n","import { memoizeOne } from '@bigcommerce/memoize';\r\nimport { noop } from 'lodash';\r\nimport React, { Component, ReactNode } from 'react';\r\n\r\nimport AccordionContext from './AccordionContext';\r\n\r\nexport interface AccordionProps {\r\n    children: ReactNode;\r\n    className?: string;\r\n    defaultSelectedItemId?: string;\r\n    isDisabled?: boolean;\r\n    onSelect?(id: string): void;\r\n}\r\n\r\nexport interface AccordionState {\r\n    selectedItemId?: string;\r\n}\r\n\r\nexport default class Accordion extends Component<AccordionProps, AccordionState> {\r\n    state: AccordionState = {};\r\n\r\n    private getContextValue = memoizeOne((selectedItemId) => {\r\n        return {\r\n            onToggle: this.handleToggleItem,\r\n            selectedItemId,\r\n        };\r\n    });\r\n\r\n    render(): ReactNode {\r\n        const { children, className = 'accordion', defaultSelectedItemId } = this.props;\r\n\r\n        const { selectedItemId = defaultSelectedItemId } = this.state;\r\n\r\n        return (\r\n            <AccordionContext.Provider value={this.getContextValue(selectedItemId)}>\r\n                <ul className={className}>{children}</ul>\r\n            </AccordionContext.Provider>\r\n        );\r\n    }\r\n\r\n    private handleToggleItem: (id: string) => void = (id) => {\r\n        const { isDisabled, onSelect = noop } = this.props;\r\n\r\n        if (isDisabled) {\r\n            return;\r\n        }\r\n\r\n        this.setState({ selectedItemId: id });\r\n        onSelect(id);\r\n    };\r\n}\r\n","import { noop } from 'lodash';\r\nimport React, {\r\n    createContext,\r\n    FunctionComponent,\r\n    memo,\r\n    ReactNode,\r\n    useCallback,\r\n    useMemo,\r\n} from 'react';\r\n\r\nimport { connectFormik, ConnectFormikProps } from '../../common/form';\r\nimport { Accordion } from '../accordion';\r\n\r\nexport interface ChecklistProps {\r\n    children: ReactNode;\r\n    defaultSelectedItemId?: string;\r\n    isDisabled?: boolean;\r\n    name: string;\r\n    onSelect?(value: string): void;\r\n}\r\n\r\nexport interface ChecklistContextProps {\r\n    name: string;\r\n}\r\n\r\nexport const ChecklistContext = createContext<ChecklistContextProps | undefined>(undefined);\r\n\r\nconst Checklist: FunctionComponent<\r\n    ChecklistProps & ConnectFormikProps<{ [key: string]: string }>\r\n> = ({ formik: { setFieldValue }, name, onSelect = noop, ...props }) => {\r\n    const handleSelect = useCallback(\r\n        (value: string) => {\r\n            setFieldValue(name, value);\r\n            onSelect(value);\r\n        },\r\n        [name, onSelect, setFieldValue],\r\n    );\r\n\r\n    const contextValue = useMemo(() => ({ name }), [name]);\r\n\r\n    return (\r\n        <ChecklistContext.Provider value={contextValue}>\r\n            <Accordion\r\n                {...props}\r\n                className=\"form-checklist optimizedCheckout-form-checklist\"\r\n                onSelect={handleSelect}\r\n            />\r\n        </ChecklistContext.Provider>\r\n    );\r\n};\r\n\r\nexport default connectFormik(memo(Checklist));\r\n","import classNames from 'classnames';\r\nimport React, { FunctionComponent, memo, ReactNode, useCallback, useContext } from 'react';\r\nimport { CSSTransition } from 'react-transition-group';\r\n\r\nimport AccordionContext from './AccordionContext';\r\n\r\nexport interface AccordionItemProps {\r\n    bodyClassName?: string;\r\n    children?: ReactNode;\r\n    className?: string;\r\n    classNameSelected?: string;\r\n    headerClassName?: string;\r\n    headerClassNameSelected?: string;\r\n    itemId: string;\r\n    headerContent(props: AccordionItemHeaderProps): ReactNode;\r\n}\r\n\r\nexport interface AccordionItemHeaderProps {\r\n    isSelected: boolean;\r\n    onToggle(id: string): void;\r\n}\r\n\r\nconst AccordionItem: FunctionComponent<AccordionItemProps> = ({\r\n    bodyClassName = 'accordion-item-body',\r\n    children,\r\n    className = 'accordion-item',\r\n    classNameSelected = 'accordion-item--selected',\r\n    headerClassName = 'accordion-item-header',\r\n    headerClassNameSelected = 'accordion-item-header--selected',\r\n    headerContent,\r\n    itemId,\r\n}) => {\r\n    const { onToggle, selectedItemId } = useContext(AccordionContext);\r\n    const isSelected = selectedItemId === itemId;\r\n\r\n    const transitionEndListener = useCallback((node, done) => {\r\n        node.addEventListener('transitionend', ({ target }: Event) => {\r\n            if (target === node) {\r\n                done();\r\n            }\r\n        });\r\n    }, []);\r\n\r\n    return (\r\n        <li\r\n            className={classNames(className, { [classNameSelected]: isSelected })}\r\n        >\r\n            <div className={classNames(headerClassName, { [headerClassNameSelected]: isSelected })}>\r\n                {headerContent({ isSelected, onToggle })}\r\n            </div>\r\n\r\n            {children && (\r\n                <CSSTransition\r\n                    addEndListener={transitionEndListener}\r\n                    classNames={bodyClassName}\r\n                    in={isSelected}\r\n                    mountOnEnter\r\n                    timeout={{}}\r\n                    unmountOnExit\r\n                >\r\n                    <div className={bodyClassName}>{children}</div>\r\n                </CSSTransition>\r\n            )}\r\n        </li>\r\n    );\r\n};\r\n\r\nexport default memo(AccordionItem);\r\n","import React, { FunctionComponent, InputHTMLAttributes } from 'react';\r\n\r\nimport Input from './Input';\r\nimport Label from './Label';\r\n\r\nexport interface ChecklistItemInputProps extends InputHTMLAttributes<HTMLInputElement> {\r\n    isSelected: boolean;\r\n}\r\n\r\nconst ChecklistItemInput: FunctionComponent<ChecklistItemInputProps> = ({\r\n    id,\r\n    isSelected,\r\n    children,\r\n    ...props\r\n}) => (\r\n    <>\r\n        <Input\r\n            {...props}\r\n            checked={isSelected}\r\n            className=\"form-checklist-checkbox optimizedCheckout-form-checklist-checkbox\"\r\n            id={id}\r\n            type=\"radio\"\r\n        />\r\n\r\n        <Label htmlFor={id}>{children}</Label>\r\n    </>\r\n);\r\n\r\nexport default ChecklistItemInput;\r\n","import { memoizeOne } from '@bigcommerce/memoize';\r\nimport { FieldProps } from 'formik';\r\nimport { kebabCase } from 'lodash';\r\nimport React, { FunctionComponent, memo, ReactNode, useCallback, useContext } from 'react';\r\n\r\nimport { AccordionItem, AccordionItemHeaderProps } from '../accordion';\r\n\r\nimport BasicFormField from './BasicFormField';\r\nimport { ChecklistContext } from './Checklist';\r\nimport ChecklistItemInput from './ChecklistItemInput';\r\n\r\nexport interface ChecklistItemProps {\r\n    content?: ReactNode;\r\n    htmlId?: string;\r\n    isDisabled?: boolean;\r\n    label: ReactNode | ((isSelected: boolean) => ReactNode);\r\n    value: string;\r\n}\r\n\r\nconst ChecklistItem: FunctionComponent<ChecklistItemProps> = ({\r\n    isDisabled,\r\n    value,\r\n    content,\r\n    htmlId = kebabCase(value),\r\n    label,\r\n    ...rest\r\n}) => {\r\n    const { name = '' } = useContext(ChecklistContext) || {};\r\n\r\n    const renderInput = useCallback(\r\n        memoizeOne((isSelected: boolean) => ({ field }: FieldProps) => (\r\n            <ChecklistItemInput\r\n                {...field}\r\n                disabled={isDisabled}\r\n                id={htmlId}\r\n                isSelected={field.value === value}\r\n                value={value}\r\n            >\r\n                {label instanceof Function ? label(isSelected) : label}\r\n            </ChecklistItemInput>\r\n        )),\r\n        [htmlId, isDisabled, label, value],\r\n    );\r\n\r\n    const handleChange = useCallback(\r\n        memoizeOne((onToggle: (id: string) => void) => (selectedValue: string) => {\r\n            if (value === selectedValue) {\r\n                onToggle(value);\r\n            }\r\n        }),\r\n        [],\r\n    );\r\n\r\n    const renderHeaderContent = useCallback(\r\n        ({ isSelected, onToggle }: AccordionItemHeaderProps) => (\r\n            <BasicFormField\r\n                className=\"form-checklist-option\"\r\n                name={name}\r\n                onChange={handleChange(onToggle)}\r\n                render={renderInput(isSelected)}\r\n            />\r\n        ),\r\n        [handleChange, name, renderInput],\r\n    );\r\n\r\n    return (\r\n        <AccordionItem\r\n            {...rest}\r\n            bodyClassName=\"form-checklist-body\"\r\n            className=\"form-checklist-item optimizedCheckout-form-checklist-item\"\r\n            classNameSelected=\"form-checklist-item--selected optimizedCheckout-form-checklist-item--selected\"\r\n            headerClassName=\"form-checklist-header\"\r\n            headerClassNameSelected=\"form-checklist-header--selected\"\r\n            headerContent={renderHeaderContent}\r\n            itemId={value}\r\n        >\r\n            {content}\r\n        </AccordionItem>\r\n    );\r\n};\r\n\r\nexport default memo(ChecklistItem);\r\n"],"names":["connectFormik","OriginalComponent","InnerComponent","memo","props","prevFormik","prevProps","nextFormik","nextProps","DecoratedComponent","connect","displayName","name","data","message","getLanguageService","translate","UnassignItemError","prototype","CustomError","getShippingMethodId","checkout","preselectedPayment","getPreselectedPayment","indexOf","providerId","undefined","SaveAddressForm","withLanguage","withFormik","handleSubmit","values","onSaveAddress","mapPropsToValues","defaultCountryCode","firstName","lastName","address1","address2","customFields","country","countryCode","stateOrProvince","stateOrProvinceCode","postalCode","phone","city","company","shouldSaveAddress","validationSchema","language","getFields","getAddressFormFieldsValidationSchema","formFields","googleMapsApiKey","countriesWithAutocomplete","countries","setFieldValue","isLoading","onRequestClose","isFloatingLabelEnabled","Form","autoComplete","LoadingOverlay","AddressForm","shouldShowSaveAddress","className","href","onClick","preventDefault","TranslatedString","id","Button","disabled","type","variant","isOpen","onAfterOpen","addressFormProps","Modal","additionalModalClassName","header","ModalHeader","shouldShowCloseButton","title","AssignItemInvalidAddressError","AssignItemFailedError","findConsignment","consignments","itemId","find","consignment","includes","lineItemIds","getShippableLineItems","cart","reduce","lineItems","physicalItems","result","item","i","addedByPromotion","isNil","parentId","concat","lineItemIndex","splitItems","quantity","key","variantId","productId","splitItem","imageUrl","options","addresses","onSelectAddress","onUseNewAddress","handleUseNewAddress","useCallback","address","handleSelectAddress","alt","src","map","optionName","value","nameId","AddressSelect","selectedAddress","shippingAddress","getRecommendedShippingOption","availableShippingOptions","ShippingOptionListItem","consignmentId","shippingOption","renderLabel","StaticShippingOption","displayAdditionalInformation","method","ChecklistItem","htmlId","label","inputName","shippingOptions","selectedShippingOptionId","onSelectedOption","handleSelect","length","Checklist","defaultSelectedItemId","onSelect","selectDefaultShippingOptions","this","selectShippingOption","getConsignments","selectedShippingOption","recommendedOption","singleShippingOption","defaultShippingOption","componentDidMount","subscribeToConsignments","unsubscribe","componentDidUpdate","analyticsTracker","shouldShowShippingOptions","showShippingMethods","componentWillUnmount","render","isMultiShippingMode","invalidShippingMessage","methodId","renderConsignment","ChecklistSkeleton","additionalClassName","rows","renderNoShippingOptions","role","StaticAddress","StaticConsignmentItemList","PureComponent","withAnalytics","noop","shippingOptionIds","forEach","ShippingOptionsForm","subscribeToConsignmentsSelector","createSelector","subscribe","subscriber","isLoadingSelector","_","isLoadingShippingOptions","isSelectingShippingOption","isUpdatingConsignment","isCreatingConsignments","isUpdatingAddress","withCheckout","checkoutService","checkoutState","getCart","getConfig","getCustomer","getCheckout","customer","config","unsortedConsignments","shippableItems","consignmentsOrder","uniq","sortBy","sortConsignments","checkoutSettings","selectConsignmentShippingOption","cartHasChanged","shouldShowOrderComments","shouldDisableSubmit","Fieldset","legend","Legend","Alert","ShippingOptions","OrderComments","state","items","handleCloseErrorModal","setState","createCustomerAddressError","handleSaveAddress","createCustomerAddress","itemAddingAddress","mapAddressFromFormValues","Error","itemKey","handleCloseAddAddressForm","assignItem","onUnhandledError","isValidAddress","syncItems","hasSelectedShippingOptions","currentItems","updatedItemIndex","cartItemIds","updatedConsignment","isEqualAddress","newId","matchingCartItems","filter","matchingCartItemIds","findNewItemId","updateShippableItems","findIndex","getDerivedStateFromProps","getShippableItemsCount","isGuest","onSignIn","onCreateAccount","TranslatedLink","ErrorModal","error","onClose","shouldShowErrorCode","hasUnassignedLineItems","onSubmit","orderComment","enableReinitialize","MultiShippingForm","onChange","labelContent","useMemo","CheckboxFormField","addressFieldName","fieldName","fieldValue","formFieldName","field","custom","handleChange","onFieldChange","handleAutocompleteToggle","inputValue","onAddressSelect","formAddress","hasAddresses","hasValidCustomerAddress","isValidCustomerAddress","unmountContentWhenLoading","onAutocompleteToggle","Component","ShippingAddressForm","handleFieldValueChange","initialize","deinitialize","buttonId","customFormFields","shouldShowCustomFormFields","style","padding","size","testId","DynamicFormField","parentFieldName","hasRequestedShippingOptions","isShippingStepPending","setSubmitted","useContext","initializeShipping","memoizeOne","defaultOptions","editAddressButtonId","amazonpay","SHIPPING_ADDRESS_FIELDS","isResettingAddress","isUpdatingShippingData","isValid","handleFieldChange","Promise","resolve","setTimeout","isShippingField","updateAddressWithFormData","handleAddressSelect","updateAddress","setValues","mapAddressToFormValues","deleteConsignments","debouncedUpdateAddress","debounce","includeShippingOptions","params","include","addressForm","shouldShowBillingSameAsShipping","some","updatedShippingAddress","Array","isArray","isEqual","contextType","billingSameAsShipping","isInitialValid","isValidSync","formValues","getCustomFormFieldsValidationSchema","SingleShippingForm","customerMessage","isBillingSameAsShipping","onMultiShippingSubmit","onSingleShippingSubmit","shouldShowAddAddressInCheckout","signOut","ShippingForm","onMultiShippingChange","shouldShowMultiShipping","width","StripeStateMapper","stateList","Object","keys","getStripeState","step","isStripeLoading","isStripeAutoStep","isShippingMethodLoading","useState","isNewAddress","setIsNewAddress","isFirstShippingRender","setIsFirstShippingRender","stripeShippingAddress","setStripeShippingAddress","handleLoading","useEffect","containerId","availableShippingList","code","allowedCountries","join","handleStripeShippingAddress","shipping","complete","phoneFieldRequired","line1","line2","postal_code","stepCompleted","isComplete","shippingPopulated","shouldShowContent","names","split","shippingValue","current","getStylesFromElement","properties","parentContainer","document","getElementById","getAppliedStyles","getStripeStyles","formInput","formLabel","formError","labelText","color","fieldText","fieldPlaceholderText","fieldErrorText","fieldBackground","fieldInnerShadow","fieldBorder","stripeupe","container","onChangeShipping","availableCountries","getStyles","gatewayId","placeholder","StripeShippingForm","stripeLoadedCallback","handleIsAutoStep","shippingFormProps","AddressFormSkeleton","display","handleMultiShippingModeSwitch","onToggleMultiShipping","updateShippingAddress","isInitializing","handleSingleShippingSubmit","addressValues","updateCheckout","updateBillingAddress","navigateNextStep","billingAddress","promises","hasRemoteBilling","push","all","unassignItem","location","handleMultiShippingSubmit","loadShippingAddressFields","loadShippingOptions","onReady","initializeShippingMethod","deinitializeShippingMethod","providerWithCustomCheckout","PaymentMethodId","email","deleteConsignmentsSelector","deleteConsignment","getShippingAddress","mapToShippingProps","getBillingAddress","getShippingAddressFields","getShippingCountries","isCreatingCustomerAddress","isLoadingShippingCountries","isUpdatingBillingAddress","isUpdatingCheckout","enableOrderComments","features","hasMultiShippingEnabled","shippableItemsCount","assignItemsToAddress","deinitializeShipping","signOutCustomer","unassignItemsToAddress","Shipping","createContext","onToggle","getContextValue","selectedItemId","handleToggleItem","isDisabled","children","AccordionContext","ChecklistContext","contextValue","Provider","bodyClassName","classNameSelected","headerClassName","headerClassNameSelected","headerContent","isSelected","transitionEndListener","node","done","addEventListener","CSSTransition","addEndListener","classNames","in","mountOnEnter","timeout","unmountOnExit","Input","checked","Label","htmlFor","content","kebabCase","rest","renderInput","Function","selectedValue","renderHeaderContent","BasicFormField"],"sourceRoot":""}